<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Oferta Especial ‚Äì 200 Receitas Exclusivas üçΩÔ∏è</title>
  <meta name="description" content="Upsell: 200 receitas exclusivas com desconto √∫nico e limitado. Oferta v√°lida apenas ap√≥s pagamento aprovado.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://sdk.mercadopago.com/js/v2"></script>
  <style>
    :root { --brand: #22c55e; }
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Liberation Sans', sans-serif; }
    .container { max-width: 980px; }
    .shadow-soft { box-shadow: 0 10px 25px rgba(2,6,23,.08); }

    #countdownBox {
      background: linear-gradient(90deg, #fbbf24, #f59e0b, #facc15);
      color: #fff;
      font-weight: 800;
      font-size: 1.9rem;
      padding: 1rem 2.5rem;
      border-radius: 1rem;
      display: inline-flex;
      align-items: center;
      gap: 0.6rem;
      box-shadow: 0 0 30px rgba(245,158,11,0.5);
      transition: all 0.3s ease;
      animation: gradientMove 3s linear infinite;
      background-size: 200% 200%;
    }
    @keyframes gradientMove {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    #countdownBox.pulse {
      animation: pulse 1s infinite, gradientMove 3s linear infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); box-shadow: 0 0 25px rgba(245,158,11,0.5); }
      50% { transform: scale(1.05); box-shadow: 0 0 45px rgba(245,158,11,0.8); }
      100% { transform: scale(1); box-shadow: 0 0 25px rgba(245,158,11,0.5); }
    }
  </style>
</head>

<body class="bg-slate-50 text-slate-900">

  <!-- Header -->
  <header class="bg-white border-b border-slate-200 sticky top-0 z-40">
    <div class="container mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="h-9 w-9 rounded-2xl bg-emerald-100 flex items-center justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-emerald-600" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6v6l4 2"/></svg>
        </div>
        <span class="font-extrabold tracking-tight">Dieta Pronta Online</span>
      </div>
      <div class="text-sm text-slate-500 hidden md:block">Oferta exclusiva para novos clientes</div>
    </div>
  </header>

  <!-- Hero -->
  <section class="bg-gradient-to-b from-white to-slate-100 text-center">
    <div class="container mx-auto px-4 py-10">
      <h1 class="text-3xl md:text-5xl font-extrabold text-emerald-600">üéâ Parab√©ns! Seu pagamento foi aprovado!</h1>
      <p class="mt-4 text-lg text-slate-700 max-w-2xl mx-auto">
        E pra te ajudar a ter <strong>resultados ainda mais r√°pidos e deliciosos</strong>, preparamos uma oportunidade <strong>√∫nica e exclusiva</strong> ‚Äî dispon√≠vel apenas agora!
      </p>

      <h2 class="mt-8 text-2xl md:text-3xl font-extrabold text-amber-600 max-w-2xl mx-auto leading-snug">
        ‚ú® Receba agora <span class="text-emerald-600">200 receitas exclusivas</span> que v√£o te ajudar a alcan√ßar seu objetivo mais r√°pido! üí™
      </h2>

      <div id="countdownBox" class="mt-6">
        ‚è∞ <span>Oferta expira em:</span> <span id="countdown">05:00</span>
      </div>

      <div class="mt-4 text-amber-600 font-semibold text-lg" id="buyersCount">
        üî• <span id="buyersNumber">27</span> pessoas aproveitaram essa oferta nas √∫ltimas 24h!
      </div>
    </div>
  </section>

  <!-- Bloco principal -->
  <section class="bg-white border-t border-b border-slate-200 py-10">
    <div class="max-w-5xl mx-auto px-4 text-center">
      <div class="max-w-2xl mx-auto">
        <div class="text-sm text-slate-500">Oferta Limitada</div>

        <h3 class="text-4xl font-extrabold mt-2 text-emerald-600">
          De <span class="text-red-500 line-through">R$ 149,90</span> por apenas <span class="text-emerald-600 text-5xl">R$ 9,90!</span>
        </h3>

        <p class="mt-4 text-slate-700 text-lg">
          Essa √© uma oportunidade √∫nica ‚Äî dispon√≠vel apenas nesta p√°gina.  
          Se sair dela, o desconto ser√° encerrado!
        </p>

        <div class="mt-5 p-4 bg-amber-50 border border-amber-200 rounded-xl text-amber-900 text-base">
          <strong>‚ö†Ô∏è Aten√ß√£o:</strong> essa condi√ß√£o especial aparece <u>somente uma vez</u>.  
          Aproveite enquanto o cron√¥metro estiver ativo!
        </div>

        <!-- Bot√µes -->
        <div class="mt-8 flex flex-col sm:flex-row justify-center gap-4">
          <a id="btnPagamento" href="#" 
             class="flex-1 text-center rounded-xl px-5 py-4 bg-[var(--brand)] text-white font-bold text-xl hover:bg-emerald-600 transition">
             Quero minhas 200 receitas por R$ 9,90 ‚ûú
          </a>

          <a href="https://dietapronta.online/approved"
             class="flex-1 text-center rounded-xl px-5 py-4 bg-red-500 text-white font-bold text-xl hover:bg-red-600 transition">
             Vou ficar somente com a dieta ‚úñ
          </a>
        </div>

        <div id="mp-checkout" class="mt-6"></div>

        <div class="mt-5 text-xs text-slate-500 text-center">
          Acesso imediato ‚Ä¢ Conte√∫do digital ‚Ä¢ Garantia de satisfa√ß√£o
        </div>
      </div>
    </div>
  </section>

  <!-- Informa√ß√µes -->
  <section id="oferta" class="py-14">
    <div class="container mx-auto px-4 grid lg:grid-cols-2 gap-10 items-center">
      <div class="rounded-2xl overflow-hidden shadow-soft border border-slate-200 bg-white">
        <img id="upsellImage" src="https://dietapronta.online/images/receitas.jpg"
             alt="Receitas saud√°veis" class="w-full h-80 object-cover"
             onerror="this.src='https://images.unsplash.com/photo-1512058564366-18510be2db19?q=80&w=1200&auto=format&fit=crop';"/>
      </div>

      <div>
        <h2 class="text-3xl font-extrabold mb-3 text-emerald-600">O que voc√™ vai receber üçΩÔ∏è</h2>
        <ul class="space-y-3 text-slate-700 text-lg">
          <li>‚úÖ <strong>200 receitas exclusivas</strong> criadas por nutricionistas.</li>
          <li>‚úÖ <strong>Caf√© da manh√£, almo√ßo, janta e lanches</strong> pr√°ticos.</li>
          <li>‚úÖ <strong>Sobremesas fit</strong> deliciosas sem sair da dieta.</li>
          <li>‚úÖ <strong>PDF completo e f√°cil de acessar</strong> no seu celular ou computador.</li>
          <li>‚úÖ Resultados reais para te manter motivado todos os dias!</li>
        </ul>
      </div>
    </div>
  </section>

  <footer class="py-10 text-center text-sm text-slate-500">
    <p>¬© <span id="year"></span> Dieta Pronta Online. Todos os direitos reservados.</p>
  </footer>

  <!-- Script -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const MP_PUBLIC_KEY = "APP_USR-87cc4830-2ac4-410d-82b8-f295612a75b0";
  const MP_ENDPOINT   = "https://dietapronta.online/api/mp-preference-upsell";
  const CHECK_STATUS  = "https://italomelo.com/server/check_status.php";
  const HOME_SUCCESS  = "https://dietapronta.online/approved-upsell";

  function $(id){ return document.getElementById(id); }
  $("year").textContent = new Date().getFullYear();

  // ======================================================
  // üî• 1) APAGAR QUALQUER REF ANTIGA (evita conflito)
  // ======================================================
  localStorage.removeItem("mp_external_ref_upsell");

  // ======================================================
  // üî• 2) Vari√°veis do cliente (OK)
  // ======================================================
  const nome  = localStorage.getItem("lead_nome") || "";
  const email = localStorage.getItem("lead_email") || "";
  const whats = localStorage.getItem("lead_whats") || "";
  const parentRef = localStorage.getItem("mp_external_ref") || "";

  // ======================================================
  // üî• 3) Bot√£o gerar pagamento ‚Äì BACKEND cria a REF
  // ======================================================
  $("btnPagamento").addEventListener("click", async (ev) => {
    ev.preventDefault();

    const btn = $("btnPagamento");
    btn.disabled = true;
    btn.textContent = "Gerando pagamento...";

    try {
      // üöÄ Agora √© o backend que cria o REF, n√£o o frontend!
      const r = await fetch(MP_ENDPOINT, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          valor: 9.90,
          customer_name: nome,
          customer_email: email,
          customer_whatsapp: whats,
          parent_reference: parentRef
        })
      });

      const data = await r.json();
      console.log("Resposta BACKEND:", data);

      if (!data || !data.id || !data.external_reference) {
        throw new Error("Erro ao criar prefer√™ncia.");
      }

      // üíæ Salva a REF criada NO BACKEND
      localStorage.setItem("mp_external_ref_upsell", data.external_reference);

      // üëâ Abre checkout Mercado Pago
      const mp = new MercadoPago(MP_PUBLIC_KEY, { locale: "pt-BR" });
      mp.checkout({
        preference: { id: data.id },
        autoOpen: true,
        render: { container: "#mp-checkout", label: "Pagar R$ 9,90" }
      });

      btn.textContent = "Abrindo pagamento...";
      startPolling(data.external_reference, btn);

    } catch (e) {
      console.error(e);
      btn.textContent = "Erro, tente novamente";
    }

    btn.disabled = false;
  });

  // ======================================================
  // üîÅ 4) Polling autom√°tico
  // ======================================================
  if (document.referrer.includes("mercadopago")) {
    const ref = localStorage.getItem("mp_external_ref_upsell");
    if (ref) {
      console.log("üü¢ Voltou do MP ‚Äî iniciando polling");
      startPolling(ref, { textContent: "" });
    }
  }

  function startPolling(ref, btn) {
    let tries = 0;

    const timer = setInterval(async () => {
      tries++;

      try {
        const res = await fetch(`${CHECK_STATUS}?ref=${encodeURIComponent(ref)}&t=${Date.now()}`);
        const data = await res.json();

        console.log("[Polling Upsell]", data);

        if (data && data.found && data.status?.toLowerCase() === "approved") {
          clearInterval(timer);
          btn.textContent = "‚úÖ Pagamento aprovado! Redirecionando...";
          setTimeout(() => window.location.href = HOME_SUCCESS, 1500);
        }
      } catch (_) {}

      if (tries > 50) clearInterval(timer);

    }, 4000);
  }
});
</script>







  
</body>
</html>
