<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pagamento pendente ‚è≥ | Dieta Pronta Online</title>
  <meta name="description" content="Pagamento em an√°lise/pendente (ex.: Pix). P√°gina com instru√ß√µes, status e atalho para WhatsApp." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --brand: #22c55e; }
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, sans-serif; }
    .container { max-width: 960px; }
    .shadow-soft { box-shadow: 0 10px 25px rgba(2, 6, 23, 0.08); }
    .badge{ display:inline-block; padding:4px 10px; border-radius:999px; font-weight:700; font-size:.8rem; }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">
  <header class="bg-white border-b border-slate-200 sticky top-0 z-40">
    <div class="container mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="h-9 w-9 rounded-2xl bg-amber-100 flex items-center justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-amber-600" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 1"/></svg>
        </div>
        <a href="/" class="font-extrabold tracking-tight hover:opacity-80">Dieta Pronta Online</a>
      </div>
    </div>
  </header>

  <main class="py-10">
    <div class="container mx-auto px-4">
      <div class="p-6 rounded-2xl bg-white border border-slate-200 shadow-soft">
        <div class="flex items-start gap-4">
          <div class="h-12 w-12 rounded-2xl bg-amber-100 flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-amber-600" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 1"/></svg>
          </div>
          <div>
            <h1 class="text-2xl md:text-3xl font-extrabold">Pagamento pendente</h1>
            <p class="mt-2 text-slate-700">Seu pagamento est√° <strong>em an√°lise</strong>. Pagamentos Pix costumam ser liberados rapidamente!</p>
            <p class="text-slate-600 text-sm">Quando seu pagamento for aprovado, voc√™ ser√° redirecionado automaticamente.</p>
          </div>
        </div>

        <div id="resumo" class="mt-6 grid md:grid-cols-3 gap-6">
          <div class="md:col-span-2 p-5 rounded-2xl border border-slate-200">
            <p class="text-sm text-slate-500">Seu plano reservado</p>
            <h2 id="planoTitle" class="mt-1 text-xl font-bold">Plano personalizado</h2>
            <p id="planoDesc" class="mt-2 text-slate-700"></p>
            <div id="etiquetas" class="mt-4 flex flex-wrap gap-2 text-sm">
              <span id="etqDieta" class="badge bg-emerald-100 text-emerald-800 hidden"></span>
              <span id="etqBiotipo" class="badge bg-emerald-100 text-emerald-800 hidden"></span>
              <span id="etqImc" class="badge bg-emerald-100 text-emerald-800 hidden"></span>
              <span id="refSpan" class="badge bg-slate-100 text-slate-800 hidden"></span>
              <span class="badge bg-amber-100 text-amber-900">Aprova√ß√£o costuma sair em poucos minutos</span>
            </div>
          </div>

          <aside class="p-5 rounded-2xl border border-slate-200">
            <p class="text-sm text-slate-500">Enquanto isso</p>
            <div class="mt-2 grid gap-3">
              <button id="btnRecarregar" class="text-center rounded-xl px-5 py-3 bg-[var(--brand)] text-white font-semibold hover:bg-emerald-600 transition">Verificar status agora</button>
              <a id="btnWhats" href="#" class="text-center rounded-xl px-5 py-3 bg-emerald-100 text-emerald-900 font-semibold hover:bg-emerald-200 transition">Falar com suporte</a>
            </div>
          </aside>
        </div>
      </div>
    </div>
  </main>

  <footer class="py-10 text-center text-sm text-slate-500">
    <p>¬© <span id="year"></span> Dieta Pronta Online. Todos os direitos reservados.</p>
  </footer>

  <!-- ========================= -->
  <!--     SCRIPT CORRIGIDO      -->
  <!-- ========================= -->
  <script>
    (function(){
      const $ = id => document.getElementById(id);
      const qs = k => new URLSearchParams(location.search).get(k) || '';

      const CHECK_STATUS = "https://italomelo.com/server/check_status.php";
      const APPROVED_URL = "https://dietapronta.online/approved?ref=";

      let ref = qs('ref') || localStorage.getItem('mp_external_ref') || '';

      // Exibe REF
      if (ref) {
        $('refSpan').textContent = "Ref: " + ref;
        $('refSpan').classList.remove("hidden");
      }

      // Bot√£o suporte
      $("btnWhats").href = "https://wa.me/5519982391022?text=" + encodeURIComponent(
        "Oi! Meu pagamento est√° pendente.\nRef: " + ref
      );

      // üî• FUN√á√ÉO PRINCIPAL DE VERIFICA√á√ÉO
      async function verificar() {
        if (!ref) return;
        try {
          const r = await fetch(`${CHECK_STATUS}?ref=${encodeURIComponent(ref)}&t=${Date.now()}`);
          const data = await r.json();
          console.log("[CHECK]", data);

          if (data.found && data.status === "approved") {
            window.location.href = APPROVED_URL + encodeURIComponent(ref);
          }
        } catch (e) { console.warn(e); }
      }

      // Verificar manualmente
      $("btnRecarregar").addEventListener("click", verificar);

      // Verifica√ß√£o autom√°tica a cada 4s (r√°pido p/ Pix)
      setInterval(verificar, 4000);

      $("year").textContent = new Date().getFullYear();
    })();
  </script>
  
</body>
</html>
