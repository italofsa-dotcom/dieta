<!DOCTYPE html>
<html lang="pt-BR">
<head>

  <!-- Google tag (gtag.js) --> 
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17661147688"></script> 
  <script> window.dataLayer = window.dataLayer || []; 
    function gtag(){dataLayer.push(arguments);} 
    gtag('js', new Date()); gtag('config', 'AW-17661147688');
  </script>

  <!-- Start of  Zendesk Widget script -->
<script id="ze-snippet" src="https://static.zdassets.com/ekr/snippet.js?key=8bd1b71a-ff84-437d-a53b-3af6d91d14a8"> </script>
<!-- End of  Zendesk Widget script -->
  
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üß† Descubra qual dieta funciona pro seu tipo de corpo</title>
  <meta name="description" content="Quiz interativo que indica a dieta ideal para o seu biotipo. Inclui c√°lculo de IMC, 16 combina√ß√µes Dieta√óBiotipo, WhatsApp e salvamento de lead em MySQL (cPanel).">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --brand: #22c55e; }
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Liberation Sans', sans-serif; }
    .container { max-width: 980px; }
    .shadow-soft { box-shadow: 0 10px 25px rgba(2, 6, 23, 0.08); }
    .hidden { display: none !important; }

    /* Box da pergunta (degrad√™ verde) */
    fieldset.step {
      position: relative;
      background: linear-gradient(135deg, #d1fae5, #a7f3d0);
      border-radius: 20px;
      padding: 28px 20px 20px 20px;
      border: 1px solid #6ee7b7;
      box-shadow: 0 8px 24px rgba(16, 185, 129, 0.20);
      transition: transform .2s ease, box-shadow .2s ease;
    }
    fieldset.step:hover { transform: scale(1.01); box-shadow: 0 10px 28px rgba(5, 150, 105, 0.25); }
    fieldset.step legend { font-size: 1.25rem; font-weight: 800; color: #064e3b; margin-bottom: 10px; padding: 0 4px; }

    /* Op√ß√µes (respostas) em branco */
    .choice label {
      background: #ffffff; border: 1.5px solid #e5e7eb; color: #0f172a; border-radius: 12px;
      transition: transform .16s ease, box-shadow .16s ease, border-color .16s ease;
      box-shadow: 0 4px 14px rgba(2, 6, 23, 0.06); display: block; padding: 12px; cursor: pointer;
    }
    .choice label:hover { transform: translateY(-1px); box-shadow: 0 8px 18px rgba(2, 6, 23, 0.10); border-color: #cbd5e1; }
    .choice input:checked + label { border-color: #10b981; box-shadow: 0 10px 24px rgba(16, 185, 129, 0.25); }

    /* Cart√µes do biotipo */
    .body-card { background:#fff; border:1.5px solid #e5e7eb; border-radius:14px; padding:14px; text-align:center; cursor:pointer; transition: transform .16s ease, box-shadow .16s ease, border-color .16s ease; box-shadow: 0 4px 14px rgba(2, 6, 23, 0.06); }
    .body-card:hover { transform: translateY(-1px); box-shadow: 0 8px 18px rgba(2, 6, 23, 0.10); border-color:#cbd5e1; }
    .body-card.selected { border-color:#10b981; box-shadow: 0 10px 24px rgba(16, 185, 129, 0.25); }

    /* Indicador de IMC */
    .imc-chip { display:inline-block; padding:4px 10px; border-radius:999px; font-size:.85rem; font-weight:700; }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">
  <!-- Header -->
  <header class="bg-white border-b border-slate-200 sticky top-0 z-40">
    <div class="container mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="h-9 w-9 rounded-2xl bg-[var(--brand)]/10 flex items-center justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-[var(--brand)]"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6v6l4 2"/></svg>
        </div>
        <span class="font-extrabold tracking-tight">Quiz de Dieta</span>
      </div>
      <nav class="hidden md:flex gap-6 text-sm text-slate-600">
        <a href="#quiz" class="hover:text-slate-900">Quiz</a>
        <a href="#resultado" class="hover:text-slate-900">Resultado</a>
      </nav>
      <a href="#quiz" class="rounded-xl px-4 py-2 bg-[var(--brand)] text-white font-semibold hover:bg-emerald-600 transition">Come√ßar</a>
    </div>
  </header>

  <!-- Hero -->
  <section class="bg-gradient-to-b from-white to-slate-100">
    <div class="container mx-auto px-4 py-10 grid lg:grid-cols-2 gap-10 items-center">
      <div>
        <h1 class="text-3xl md:text-5xl font-extrabold leading-tight">üß† Descubra agora qual a dieta que realmente funciona com seu corpo!</h1>
        <p class="mt-4 text-lg text-slate-600">Tenha sua Dieta 100% Personalizada: Inteligente, Feita pro SEU Corpo ‚Äì Resultados Reais, Sem Promessas Falsas! Obtenha resultados com m√©todo que j√° mudou a vida de milhares de pessoas!</p>
        <div class="mt-6 flex gap-3">
          <a href="#quiz" class="rounded-xl px-6 py-3 bg-[var(--brand)] text-white font-semibold hover:bg-emerald-600 transition">Come√ßar agora</a>
          <span class="text-slate-500 self-center">Leva ~1 minuto</span>
        </div>
      </div>
      <div class="relative">
        <div class="rounded-2xl overflow-hidden shadow-soft border border-slate-200 bg-white">
          <img src="https://images.unsplash.com/photo-1544025162-d76694265947?q=80&w=1600&auto=format&fit=crop" alt="Comida saud√°vel" class="w-full h-72 object-cover"/>
          <div class="p-6">
            <h3 class="text-xl font-bold">Resultado personalizado</h3>
            <p class="mt-1 text-slate-600">Direcionamento claro combinando <strong>biotipo</strong>, <strong>IMC</strong> e <strong>perfil</strong> ‚Äî para uma estrat√©gia realmente execut√°vel.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Quiz -->
  <section id="quiz" class="py-10 bg-white border-t border-b border-slate-200">
    <div class="container mx-auto px-4">
      <div class="p-6 rounded-2xl bg-white border border-slate-200 shadow-soft">
        <div id="statusBanner" class="hidden mb-4 rounded-xl px-4 py-3 text-sm border"></div>

        <div class="flex items-center justify-between mb-4">
          <div>
            <h2 class="text-2xl font-extrabold">Responda √†s perguntas</h2>
            <p id="microcopy" class="text-slate-600 text-sm mt-1">Come√ßamos entendendo sua rotina. Dica: responda com sinceridade üòâ</p>
          </div>
          <div class="w-52 text-right">
            <div class="h-2 rounded-full bg-slate-200 overflow-hidden" aria-hidden="true">
              <div id="progress" class="h-2 bg-[var(--brand)] w-0"></div>
            </div>
            <p class="text-xs text-slate-500 mt-1">
              <span id="progressCount">0/20</span> ‚Ä¢ <span id="pct">0%</span>
            </p>
          </div>
        </div>

        <form id="quizForm" class="grid gap-6"><noscript>Ative o JavaScript para visualizar as perguntas do quiz.</noscript></form>

        <div class="mt-6 flex items-center justify-between">
          <button id="btnPrev" class="rounded-xl px-4 py-2 border border-slate-300 font-semibold disabled:opacity-40" disabled>Voltar</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Resultado -->
  <section id="resultado" class="py-12 hidden">
    <div class="container mx-auto px-4">
      <div class="p-6 rounded-2xl bg-white border border-slate-200 shadow-soft">
        <p class="text-sm text-slate-500">Seu resultado</p>
        <h2 id="resultTitle" class="text-2xl md:text-3xl font-extrabold"></h2>
        <p id="resultDesc" class="mt-2 text-slate-700"></p>

          <div class="mt-6 p-5 rounded-2xl bg-emerald-50 border border-emerald-200">
          <h2 class="font-bold">Receba AGORA seu plano COMPLETO e personalizado no WhatsApp</h2>
          <p class="text-slate-700 mt-1">Preencha seus dados abaixo e receba imediatamente!</p>
          <form id="leadForm" class="mt-3 grid md:grid-cols-4 gap-3" onsubmit="return handleLead(event)">
            <input id="nome" type="text" required placeholder="Seu nome" class="rounded-xl border-slate-300" />
            <input id="email" type="email" required placeholder="Seu e-mail" class="rounded-xl border-slate-300"
                   autocomplete="email" inputmode="email" autocapitalize="none" autocorrect="off" spellcheck="false" />
            <input id="whats" type="tel" inputmode="tel" required placeholder="(61) 9 9999-9999" class="rounded-xl border-slate-300" />
            <button class="rounded-xl px-6 py-3 bg-[var(--brand)] text-white font-semibold">Continuar</button>
          </form>
          <p id="leadOk" class="hidden text-emerald-700 text-sm mt-2">Quase l√°! Preparando sua p√°gina‚Ä¶</p>
        </div>

        <div class="mt-6 grid md:grid-cols-2 gap-6">
          <div class="p-5 rounded-2xl border border-slate-200">
            <h3 class="font-bold">Sugest√µes pr√°ticas</h3>
            <ul id="tips" class="mt-2 list-disc list-inside text-slate-700 space-y-1"></ul>
          </div>
          <div class="p-5 rounded-2xl border border-slate-200">
            <h3 class="font-bold">Mini card√°pio (exemplo)</h3>
            <ul id="menu" class="mt-2 list-disc list-inside text-slate-700 space-y-1"></ul>
          </div>
        </div>

        <div class="mt-4">
          <button id="btnReview" class="rounded-xl px-4 py-2 border border-slate-300 font-semibold">Rever respostas</button>
        </div>


      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="py-10 text-center text-sm text-slate-500">
    <p>¬© <span id="year"></span> Dieta Pronta Online. Todos os direitos reservados.</p>
  </footer>

  <script>
  (function(){
    /* ===================== CONFIG ===================== */
    var PRE_PAG_URL   = "/pre-pagamento/";           // p√°gina de pr√©-pagamento
    var LEAD_ENDPOINT = "https://italomelo.com/server/save_lead.php";      // endpoint PHP no seu cPanel
    var LEAD_TOKEN    = "2a8e5cda3b49e2f6f72dc0d4a1f9f83e9c0fda8b2f7a3e1c4d6b9e7f5a2c1d8e"; // IGUAL AO config.php

    /* ================== MICROCOPY & MODELOS ============ */
    var MICROCOPY = {
      0:  "Come√ßamos entendendo sua rotina. Dica: responda com sinceridade üòâ",
      4:  "√ìtimo! J√° conseguimos captar seu ritmo. Continuando‚Ä¶",
      8:  "Metade do caminho! Essas pr√≥ximas ajudam a refinar seu perfil.",
      12: "Estamos quase l√°. Ajustes finos fazem diferen√ßa.",
      16: "Seu plano est√° praticamente pronto. √öltimos detalhes!"
    };

    var PROFILES = {
      A:{title:"ü•ë Low Carb / Cetog√™nica",desc:"Foco em prote√≠nas magras, gorduras boas e carboidratos bem controlados.",tips:["Priorize ovos, peixes, carnes magras, abacate e azeite","Troque refrigerantes por √°gua com lim√£o","Inclua fibras (verduras, legumes) para saciedade"],menu:["Caf√©: omelete com queijo + abacate","Almo√ßo: frango grelhado + salada com azeite","Jantar: salm√£o + legumes salteados"]},
      B:{title:"üçö Balanceada / Mediterr√¢nea",desc:"Equil√≠brio entre carboidratos complexos, prote√≠nas e gorduras boas.",tips:["Prato colorido e variado","Gr√£os integrais, frutas e verduras","Azeite e oleaginosas com modera√ß√£o"],menu:["Caf√©: iogurte + granola + frutas","Almo√ßo: arroz integral, feij√£o, peixe e salada","Jantar: sopa de legumes + frango desfiado"]},
      C:{title:"ü•© Proteica / Hiperproteica",desc:"Alta ingest√£o de prote√≠na com carboidratos ajustados para defini√ß√£o e manuten√ß√£o de massa magra.",tips:["Fonte proteica em todas as refei√ß√µes","Whey/Prote√≠na com orienta√ß√£o profissional","Hidrate-se e ajuste fibras"],menu:["Caf√©: ovos mexidos + queijo branco","Almo√ßo: patinho + salada + quinoa","Jantar: omelete de claras + legumes"]},
      D:{title:"üïí Jejum Intermitente / Flex√≠vel",desc:"Janelas de alimenta√ß√£o bem definidas, sem exageros nas quebras do jejum.",tips:["Defina janela (ex.: 16/8) com orienta√ß√£o","Prote√≠nas e fibras na primeira refei√ß√£o","√Ågua, caf√© sem a√ß√∫car e ch√°s no jejum"],menu:["1¬™ refei√ß√£o: bowl proteico (iogurte grego + nuts)","2¬™: frango + legumes + arroz integral","3¬™ (opcional): sopa de legumes + ovos"]}
    };

// var BODY_TYPES = [
//      { key:'ECTO', name:'Ectomorfo', svg:`<svg viewBox='0 0 64 64' class='mx-auto h-16 w-16'><rect x='28' y='8' width='8' height='12' rx='4' fill='#10b981'/><rect x='26' y='20' width='12' height='18' rx='6' fill='#34d399'/><rect x='24' y='38' width='16' height='20' rx='8' fill='#a7f3d0'/></svg>` },
 //     { key:'MESO', name:'Mesomorfo', svg:`<svg viewBox='0 0 64 64' class='mx-auto h-16 w-16'><rect x='28' y='8' width='8' height='12' rx='4' fill='#10b981'/><rect x='22' y='20' width='20' height='18' rx='8' fill='#34d399'/><rect x='20' y='38' width='24' height='20' rx='10' fill='#a7f3d0'/></svg>` },
//      { key:'ENDO', name:'Endomorfo', svg:`<svg viewBox='0 0 64 64' class='mx-auto h-16 w-16'><rect x='28' y='8' width='8' height='12' rx='4' fill='#10b981'/><rect x='18' y='20' width='28' height='18' rx='10' fill='#34d399'/><rect x='14' y='38' width='36' height='20' rx='12' fill='#a7f3d0'/></svg>` },
//      { key:'EQUI', name:'Equilibrado', svg:`<svg viewBox='0 0 64 64' class='mx-auto h-16 w-16'><rect x='28' y='8' width='8' height='12' rx='4' fill='#10b981'/><rect x='24' y='20' width='16' height='18' rx='7' fill='#34d399'/><rect x='22' y='38' width='20' height='20' rx='9' fill='#a7f3d0'/></svg>` }
//    ];

    var BODY_TYPES = [
  {
    label: "Endomorfo",
    value: "endomorfo",
    image: "https://dietapronta.online/img/endomorfo.png"
  },
  {
    label: "Mesomorfo",
    value: "mesomorfo",
    image: "https://dietapronta.online/img/Mesomorfo.png"
  },
  {
    label: "Ectomorfo",
    value: "ectomorfo",
    image: "https://dietapronta.online/img/ectomorfo.png"
  },
  {
    label: "Equilibrado",
    value: "equilibrado",
    image: "https://dietapronta.online/img/equilibrado.png"
  }
];


    var COMBOS = {
      'A-ECTO': { title:'Plano Ectomorfo Low Carb', desc:'Estrat√©gia para reduzir gordura sem perder performance; mant√©m carboidratos de qualidade em treinos.' },
      'A-MESO': { title:'Plano Mesomorfo Low Carb', desc:'Foco em defini√ß√£o com estabilidade energ√©tica; ciclos de carboidrato em dias estrat√©gicos.' },
      'A-ENDO': { title:'Plano Endomorfo Low Carb', desc:'Controle glic√™mico e saciedade como base; prioriza fibras e gorduras boas.' },
      'A-EQUI': { title:'Plano Equilibrado Low Carb', desc:'Abordagem moderada e flex√≠vel; cortes inteligentes de a√ß√∫cares e farinhas.' },

      'B-ECTO': { title:'Plano Ectomorfo Balanceado', desc:'Mais carboidratos complexos para energia sustentada; foco em densidade nutritiva.' },
      'B-MESO': { title:'Plano Mesomorfo Balanceado', desc:'Distribui√ß√£o harm√¥nica de macros; excelente para manuten√ß√£o e performance.' },
      'B-ENDO': { title:'Plano Endomorfo Balanceado', desc:'Controle de por√ß√µes e prioriza√ß√£o de integrais; evita picos de fome.' },
      'B-EQUI': { title:'Plano Equilibrado Mediterr√¢neo', desc:'Variedade e prazer em comer bem; base em frutas, verduras, azeite e peixes.' },

      'C-ECTO': { title:'Plano Ectomorfo Proteico', desc:'Prote√≠nas em todas as refei√ß√µes; carboidrato ajustado para ganho limpo.' },
      'C-MESO': { title:'Plano Mesomorfo Proteico', desc:'Alta saciedade e manuten√ß√£o de massa; carbo em torno do treino.' },
      'C-ENDO': { title:'Plano Endomorfo Proteico', desc:'Redu√ß√£o de gordura com preserva√ß√£o muscular; √™nfase em fibras e prote√≠na.' },
      'C-EQUI': { title:'Plano Equilibrado Proteico', desc:'F√°cil ades√£o, alto poder de saciedade; combina com rotina corrida.' },

      'D-ECTO': { title:'Plano Ectomorfo Jejum Flex√≠vel', desc:'Janelas mais curtas, aten√ß√£o √† ingest√£o proteica nas quebras.' },
      'D-MESO': { title:'Plano Mesomorfo Jejum Flex√≠vel', desc:'Controle cal√≥rico simples e eficiente; refei√ß√µes completas nas janelas.' },
      'D-ENDO': { title:'Plano Endomorfo Jejum Flex√≠vel', desc:'Ajuda no controle de apetite; cuidado com quebras ricas em prote√≠na e vegetais.' },
      'D-EQUI': { title:'Plano Equilibrado Jejum Flex√≠vel', desc:'Pr√°tico e sustent√°vel; prioriza qualidade nas janelas de alimenta√ß√£o.' }
    };

    // 20 perguntas (17 r√°dio + altura + peso + biotipo)
    var QUESTIONS = [
      {type:'radio', q:"Vamos come√ßar.. informe seu g√™nero", a:["HOMEM","MULHER"]},
      {type:'radio', q:"Qual sua faixa et√°ria?", a:["15 a 25 anos","26 a 35 anos","36 a 49 anos","tenho + 50 anos"]},
      {type:'radio', q:"Qual seu principal objetivo agora?", a:["Emagrecer r√°pido","Ganhar massa magra","Manter peso e sa√∫de","Reduzir gordura localizada"]},
      {type:'radio', q:"Seu n√≠vel de energia di√°rio √©‚Ä¶", a:["Sempre cansado","Oscila muito","Constante","Muito alto"]},
      {type:'radio', q:"Seu apetite ao longo do dia √©‚Ä¶", a:["Forte de manh√£","Mais fome √† noite","Pouco apetite","Muita fome o tempo todo"]},
      {type:'radio', q:"Quantas refei√ß√µes principais por dia?", a:["2 ou menos","3","4 a 5","Mais de 5 pequenas"]},
      {type:'radio', q:"Fome emocional/ansiosa?", a:["Sim, muito","√Äs vezes","Raramente","Nunca"]},
      {type:'radio', q:"N√≠vel de atividade f√≠sica", a:["Sedent√°rio","Leve","Moderado (3x/sem)","Intenso (5x+)"]},
      {type:'radio', q:"Seu sono √©‚Ä¶", a:["Ruim","Durmo bem mas acordo cansado","Regular","Muito bom"]},
      {type:'radio', q:"Costuma pular o caf√© da manh√£?", a:["Sempre","√Äs vezes","Raramente","Nunca"]},
      {type:'radio', q:"Seu estilo de alimenta√ß√£o atual", a:["Muito carboidrato","Equilibrada","Rica em prote√≠na","Desorganizada"]},
      {type:'radio', q:"Vontade de doces", a:["Sempre","√Äs vezes","Raramente","Quase nunca"]},
      {type:'radio', q:"Seu tipo de corpo (percep√ß√£o)", a:["Ganha peso f√°cil","Dificuldade para ganhar peso","Oscila r√°pido","Equilibrado"]},
      {type:'radio', q:"Rea√ß√£o aos carboidratos", a:["Engordo r√°pido","Sem efeito","D√° energia","Fico inchado"]},
      {type:'radio', q:"Prefere refei√ß√µes‚Ä¶", a:["Leves e frequentes","Poucas e completas","Grandes √† noite","Equilibradas"]},
      {type:'radio', q:"Consegue ficar longos per√≠odos sem comer?", a:["Sim, tranquilo","Pouco tempo","Depende do dia","N√£o consigo"]},
      {type:'radio', q:"N√≠vel de organiza√ß√£o das refei√ß√µes", a:["Planejo tudo","Planejo parte","Improviso muito","Quase nunca penso nisso"]},
      {type:'input-height', q:"Qual a sua altura? (em cent√≠metros)", placeholder:"Ex.: 173"},
      {type:'input-weight', q:"Qual o seu peso atual? (em kg)", placeholder:"Ex.: 78"},
      {type:'body', q:"Agora escolha seu tipo de corpo (biotipo)", a: BODY_TYPES},
      {type:'radio', q:"Como √© sua rotina durante a semana?", a:["Muito corrida","Relativamente organizada","Bastante flex√≠vel","Muito sedent√°ria"]},
      {type:'radio', q:"Qual frase te representa?", a:["Quero resultados r√°pidos","Prefiro algo sustent√°vel","Quero comer bem e perder peso","Quero performance m√°xima"]}
    ];

    var selected = new Array(QUESTIONS.length).fill(null);
    var scores = {A:0,B:0,C:0,D:0};
    var current = 0;
    var heightCm = null, weightKg = null, imcValue = null, imcLabel = '';
    var bodyTypeKey = null;

    function $(id){ return document.getElementById(id); }
    var form = $("quizForm");

    // Persist√™ncia
    try {
      var _c = parseInt(localStorage.getItem('quiz_current')||'0', 10);
      if (isNaN(_c) || _c < 0 || _c >= QUESTIONS.length) {
        localStorage.removeItem('quiz_current');
      }
    } catch(_) {}

    function saveProgress(){
      try{
        localStorage.setItem('quiz_selected', JSON.stringify(selected));
        localStorage.setItem('quiz_current', String(current));
        localStorage.setItem('quiz_height_cm', heightCm==null? '': String(heightCm));
        localStorage.setItem('quiz_weight_kg', weightKg==null? '': String(weightKg));
        localStorage.setItem('quiz_body_key', bodyTypeKey||'');
        if(imcValue!=null){ localStorage.setItem('quiz_imc_value', String(imcValue)); }
        if(imcLabel){ localStorage.setItem('quiz_imc_label', imcLabel); }
      }catch(_){ }
    }
    function loadProgress(){
      try{
        var s = JSON.parse(localStorage.getItem('quiz_selected')||'[]');
        if(Array.isArray(s) && s.length===selected.length) selected=s;
        var c = parseInt(localStorage.getItem('quiz_current')||'0',10);
        if(!isNaN(c) && c>=0 && c<selected.length) current=c;
        var h = localStorage.getItem('quiz_height_cm'); if(h) heightCm = parseFloat(h);
        var w = localStorage.getItem('quiz_weight_kg'); if(w) weightKg = parseFloat(w);
        var b = localStorage.getItem('quiz_body_key'); if(b) bodyTypeKey=b;
        var iv= localStorage.getItem('quiz_imc_value'); if(iv) imcValue = parseFloat(iv);
        var il= localStorage.getItem('quiz_imc_label'); if(il) imcLabel = il;
      }catch(_){ }
    }

    function scrollToQuizTop(){
      var box = document.querySelector('#quiz .p-6');
      var top = box ? box.getBoundingClientRect().top + window.scrollY - 80 : 0;
      window.scrollTo({ top, behavior: 'smooth' });
    }

    function imcCompute(){
      if(heightCm && weightKg){
        var m = heightCm/100; var v = weightKg / (m*m);
        imcValue = Math.round(v*10)/10;
        if(v<18.5) imcLabel='abaixo do peso';
        else if(v<25) imcLabel='faixa saud√°vel';
        else if(v<30) imcLabel='sobrepeso';
        else imcLabel='obesidade leve';
        showImcChip();
      }
    }

    function showImcChip(){
      var banner = $("statusBanner"); if(!banner) return;
      if(imcValue==null) { banner.classList.add('hidden'); return; }
      var color='bg-emerald-50 border-emerald-300 text-emerald-800';
      if(imcLabel==='sobrepeso') color='bg-amber-50 border-amber-300 text-amber-900';
      if(imcLabel==='obesidade leve') color='bg-rose-50 border-rose-300 text-rose-800';
      banner.innerHTML = "<span class='imc-chip "+color+"'>IMC "+imcValue+" ‚Äî "+imcLabel+"</span> " +
        "<span class='ml-2 text-slate-700'>Perfeito, vamos ajustar tudo pensando no seu contexto. Pequenos passos, grande impacto. üí™</span>";
      banner.className = "mb-4 rounded-xl px-4 py-3 text-sm border "+color;
      banner.classList.remove('hidden');
    }

    function microcopyFor(step){
      var k = [16,12,8,4,0].find(function(x){return step>=x;});
      return MICROCOPY[k] || MICROCOPY[0];
    }

    function renderQuestions(){
      var html="";
      for(var i=0;i<QUESTIONS.length;i++){
        var it = QUESTIONS[i];
        html += '<fieldset data-step="'+i+'" class="step'+(i===0?'':' hidden')+'">';
        html += '<legend>'+(i+1)+'. '+ it.q +'</legend>';
        if(it.type==='radio'){
          html += '<div class="mt-3 grid sm:grid-cols-2 gap-3">';
          for(var j=0;j<it.a.length;j++){
            var letter=String.fromCharCode(65+j);
            var id="q"+i+"_"+letter;
            html += '<div class="choice">';
            html += '<input class="peer hidden" type="radio" id="'+id+'" name="q'+i+'" value="'+letter+'" required />';
            html += '<label for="'+id+'" class="block text-[1.05rem]">'+ it.a[j] +'</label>';
            html += '</div>';
          }
          html += '</div>';
        } else if(it.type==='input-height'){
          var v = heightCm!=null? String(heightCm):'';
          html += '<div class="mt-2">';
          html += '<input id="heightCm" type="number" min="120" max="230" step="1" value="'+v+'" placeholder="'+(it.placeholder||'Ex.: 170')+'" class="rounded-xl border-slate-300 w-full p-3" />';
          html += '<p class="text-xs text-slate-600 mt-2">Use cent√≠metros. Ex.: 173</p>';
          html += '</div>';
        } else if(it.type==='input-weight'){
          var wv = weightKg!=null? String(weightKg):'';
          html += '<div class="mt-2">';
          html += '<input id="weightKg" type="number" min="35" max="250" step="0.1" value="'+wv+'" placeholder="'+(it.placeholder||'Ex.: 78')+'" class="rounded-xl border-slate-300 w-full p-3" />';
          html += '<p class="text-xs text-slate-600 mt-2">Use quilogramas. Ex.: 78.5</p>';
          html += '</div>';
        } else if(it.type==='body'){
          html += '<div class="mt-3 grid sm:grid-cols-2 md:grid-cols-4 gap-3">';
          for(var b=0;b<BODY_TYPES.length;b++){
            var bt = BODY_TYPES[b];
            var sel = (bodyTypeKey===bt.key)? ' selected':'';
            html += '<div class="body-card'+sel+'" data-body="'+bt.key+'">'+bt.svg+'<div class="mt-2 font-semibold">'+bt.name+'</div></div>';
          }
          html += '</div>';
        }
        html += '</fieldset>';
      }
      form.innerHTML = html;

      for(var i=0;i<selected.length;i++){
        var v = selected[i]; if(!v) continue;
        var input = document.getElementById('q'+i+'_'+v);
        if(input) input.checked = true;
      }
      if(heightCm!=null){ var h=$('heightCm'); if(h){ h.value = String(heightCm); } }
      if(weightKg!=null){ var w=$('weightKg'); if(w){ w.value = String(weightKg); } }
      if(bodyTypeKey){
        var cards = form.querySelectorAll('.body-card');
        cards.forEach(function(c){ if(c.getAttribute('data-body')===bodyTypeKey) c.classList.add('selected'); });
      }
      updateProgress();
    }

    function recomputeScores(){
      scores.A=scores.B=scores.C=scores.D=0;
      for(var i=0;i<selected.length;i++){
        var v=selected[i]; if(!v) continue;
        if(scores[v]!=null) scores[v]++;
      }
      if(imcValue!=null){
        if(imcValue>=25){ scores.A++; scores.C++; }
        else if(imcValue<18.5){ scores.B++; scores.C++; }
      }
    }

    function updateProgress(){
      var pct = Math.round((current)/QUESTIONS.length*100);
      $('progress').style.width = pct + '%';
      $('pct').textContent = pct + '%';
      $('progressCount').textContent = current + '/' + QUESTIONS.length;
      $('btnPrev').disabled = (current===0);
      $('microcopy').textContent = microcopyFor(current);
    }

    function gotoStep(n){
      var cur = form.querySelector('.step[data-step="'+current+'"]');
      var nxt = form.querySelector('.step[data-step="'+n+'"]');
      if(cur) cur.classList.add('hidden');
      if(nxt) nxt.classList.remove('hidden');
      current = n;
      updateProgress();
      saveProgress();
      scrollToQuizTop();
    }

    function nextStep(){
      if(current < QUESTIONS.length - 1){
        gotoStep(current + 1);
        return;
      }
      document.getElementById('quiz').classList.add('hidden');
      showResult();
    }

    function prevStep(){ if(current>0) gotoStep(current-1); }

    function bestDietKey(){
      var bestKey='A', best=-1; for(var k in scores){ if(scores[k]>best){ best=scores[k]; bestKey=k; } }
      return bestKey;
    }

    function bodyKeyToName(k){
      var bt = BODY_TYPES.find(function(x){ return x.key===k; });
      return bt ? bt.name : 'Equilibrado';
    }

    function finalizeCombo(dietKey){
      var bt = bodyTypeKey || 'EQUI';
      var comboKey = dietKey + '-' + bt;
      var combo = COMBOS[comboKey] || { title:'Plano Personalizado', desc:'Combina√ß√£o adaptada ao seu contexto atual.' };

      var imcMsg = '';
      if(imcValue!=null){
        var tone = {
          'abaixo do peso': 'Vamos refor√ßar densidade nutricional sem exageros para recuperar equil√≠brio. Voc√™ est√° no caminho certo. ',
          'faixa saud√°vel': 'Excelente! Vamos preservar seu bem-estar com escolhas inteligentes e sustent√°veis. ',
          'sobrepeso': 'Vamos reduzir gordura com seguran√ßa e foco em saciedade e energia constante. ',
          'obesidade leve': 'Nossa prioridade √© conforto, regularidade e progresso consistente ‚Äî sem radicalismos. '
        };
        imcMsg = 'Seu IMC √© '+imcValue+' ('+imcLabel+'). ' + (tone[imcLabel]||'');
      }

      var prof = PROFILES[dietKey];
      var title = 'üéØ ' + combo.title;
      var desc = (imcMsg? imcMsg: '') + (combo.desc || '') + ' ' + (prof? prof.desc: '');

      var bodyName = bodyKeyToName(bt);
      // Remove qualquer s√≠mbolo inicial (ex.: emoji) sem usar regex unicode
      var dietTitle = prof ? prof.title.replace(/^[^A-Za-z0-9]+/, '').trim() : 'Plano alimentar';

      try{
        localStorage.setItem('quiz_result_diet_key', dietKey);
        localStorage.setItem('quiz_result_diet_title', dietTitle);
        localStorage.setItem('quiz_result_body_key', bt);
        localStorage.setItem('quiz_result_body_name', bodyName);
        localStorage.setItem('quiz_result_title', title);
        localStorage.setItem('quiz_result_desc', desc);
      }catch(_){ }

      $('resultTitle').textContent = title;
      $('resultDesc').textContent = desc;
      var tips = (prof? prof.tips: ["Hidrate-se","Priorize alimentos naturais","Evite ultraprocessados"]);
      $('tips').innerHTML = tips.map(x=>'<li>'+x+'</li>').join('');
      var menu = (prof? prof.menu: ["Caf√©: ovo + fruta","Almo√ßo: grelhado + salada","Jantar: sopa de legumes"]);
      $('menu').innerHTML = menu.map(x=>'<li>'+x+'</li>').join('');

      $('resultado').classList.remove('hidden');
      $('progress').style.width='100%';
      $('pct').textContent='100%';
      $('progressCount').textContent=QUESTIONS.length + '/' + QUESTIONS.length;
    }

    function showResult(){
      recomputeScores();
      var dietKey = bestDietKey();
      finalizeCombo(dietKey);
    }

    // Eventos principais
    document.addEventListener('change', function(e){
      var t = e.target; if(!t) return;
      if(t.type==='radio' && t.name && t.name.startsWith('q')){
        var fs = t.closest('fieldset.step'); if(!fs) return;
        var idx = parseInt(fs.getAttribute('data-step'),10);
        var letter = t.value; selected[idx] = letter; recomputeScores(); saveProgress();
        setTimeout(nextStep, 120);
        return;
      }
    });

    document.addEventListener('input', function(e){
      var t=e.target; if(!t) return;
      if(t.id==='heightCm'){
        var v = parseInt(t.value,10); if(!isNaN(v)) heightCm=v; else heightCm=null;
        imcCompute(); saveProgress();
      }
      if(t.id==='weightKg'){
        var w = parseFloat(t.value); if(!isNaN(w)) weightKg=w; else weightKg=null;
        imcCompute(); saveProgress();
      }
    });
    document.addEventListener('change', function(e){
      var t=e.target; if(!t) return;
      if(t.id==='heightCm' || t.id==='weightKg'){
        var go=false;
        if(t.id==='heightCm' && heightCm>=120 && heightCm<=230) go=true;
        if(t.id==='weightKg' && weightKg>=35 && weightKg<=250) go=true;
        if(go){ recomputeScores(); setTimeout(nextStep,120); }
      }
    });

    form.addEventListener('click', function(e){
      var card = e.target.closest('.body-card'); if(!card) return;
      var k = card.getAttribute('data-body');
      bodyTypeKey = k;
      form.querySelectorAll('.body-card').forEach(function(c){ c.classList.remove('selected'); });
      card.classList.add('selected');
      var idxBody = QUESTIONS.findIndex(function(q){return q.type==='body'});
      if(idxBody>=0) selected[idxBody] = 'D';
      saveProgress();
      setTimeout(nextStep, 120);
    });

    document.addEventListener('keydown', function(e){
      var tag = (e.target && e.target.tagName) ? e.target.tagName.toLowerCase() : '';
      if(tag==='input' || tag==='textarea' || e.metaKey || e.ctrlKey || e.altKey) return;
      var map = { '1':'A', '2':'B', '3':'C', '4':'D' };
      if(!map[e.key]) return;
      var input = document.getElementById('q'+current+'_'+map[e.key]);
      if(input){ input.checked=true; input.dispatchEvent(new Event('change', {bubbles:true})); }
    });

    $('btnPrev').addEventListener('click', function(e){ e.preventDefault(); prevStep(); });

    // ========= SALVAR LEAD NO MYSQL (cPanel) =========
    async function salvarLeadNoServidor({ref, nome, email, whats}){
      var dietTitle = localStorage.getItem('quiz_result_diet_title') || '';
      var bodyName  = localStorage.getItem('quiz_result_body_name')  || '';
      var imcVal    = localStorage.getItem('quiz_imc_value') || '';
      var imcLbl    = localStorage.getItem('quiz_imc_label') || '';

      var fd = new FormData();
      fd.append('token',      LEAD_TOKEN);
      fd.append('ref',        ref || '');
      fd.append('name',       nome || '');
      fd.append('email',      email || '');
      fd.append('phone',      whats || '');
      fd.append('diet_title', dietTitle);
      fd.append('body_type',  bodyName);
      fd.append('imc_value',  imcVal);
      fd.append('imc_label',  imcLbl);

      try {
        const ctrl = new AbortController();
        const tm   = setTimeout(()=>ctrl.abort(), 2500);
        await fetch(LEAD_ENDPOINT, { method:'POST', body: fd, signal: ctrl.signal, credentials:'same-origin' });
        clearTimeout(tm);
      } catch(_) { /* n√£o bloqueia o fluxo */ }
    }

    function uuidRef(){ return 'ref-' + Date.now() + '-' + Math.random().toString(36).slice(2,8); }

    window.handleLead = async function(e){
      e.preventDefault();
      var nome  = $('nome').value.trim();
      var email = $('email').value.trim();
      var whats = $('whats').value.trim();
      try{
        localStorage.setItem('lead_nome',nome);
        localStorage.setItem('lead_email',email);
        localStorage.setItem('lead_whats',whats);
      }catch(_){ }
      $('leadOk').classList.remove('hidden');

      var ref=uuidRef(); try{ localStorage.setItem('mp_external_ref', ref);}catch(_){}

      await salvarLeadNoServidor({ ref, nome, email, whats });

      var u=new URL(PRE_PAG_URL, location.origin);
      u.searchParams.set('ref', ref);
      u.searchParams.set('nome', nome);
      u.searchParams.set('email', email);
      u.searchParams.set('whats', whats);
      location.href=u.toString();
      return false;
    }

    // P√≥s-pagamento (status=approved) ‚Üí WhatsApp com Dieta + Biotipo + IMC
    ;(function detectarStatus(){
      var p=new URLSearchParams(location.search);
      var status=p.get('status');
      var banner=$('statusBanner');
      function showBanner(texto,classes){ banner.textContent=texto; banner.className='mb-4 rounded-xl px-4 py-3 text-sm border '+classes; banner.classList.remove('hidden'); }

      function abrirWhatsAppComResultado(){
        var nome=$('nome')?$('nome').value.trim():(localStorage.getItem('lead_nome')||'');
        var result= localStorage.getItem('quiz_result_title') || ($('resultTitle')?$('resultTitle').textContent:'') || 'Plano de dieta';
        var desc  = localStorage.getItem('quiz_result_desc')  || ($('resultDesc')?$('resultDesc').textContent:'') || '';
        var dietTitle = localStorage.getItem('quiz_result_diet_title') || '';
        var bodyName  = localStorage.getItem('quiz_result_body_name')  || '';
        var imcVal = localStorage.getItem('quiz_imc_value') || '';
        var imcLbl = localStorage.getItem('quiz_imc_label') || '';

        var linhas = [];
        linhas.push("Oi, sou "+(nome||"cliente")+".");
        linhas.push("Meu resultado no Quiz foi: "+result+".");
        if(dietTitle || bodyName){ linhas.push("‚Ä¢ Biotipo: "+(bodyName||"-")+" ‚Ä¢ Dieta: "+(dietTitle||"-")); }
        if(imcVal){ linhas.push("‚Ä¢ IMC: "+imcVal + (imcLbl? " ("+imcLbl+")":"")); }
        if(desc){ linhas.push("Resumo: "+desc); }
        linhas.push("Pagamento confirmado. Quero receber meu plano completo.");

        var link='https://wa.me/5519982391022?text='+encodeURIComponent(linhas.join("\n"));
        window.open(link,'_blank');
      }

      if(status==='approved'){ setTimeout(abrirWhatsAppComResultado,300); return; }
      if(status==='failure'){ showBanner('N√£o foi poss√≠vel validar seu resultado agora. Voc√™ pode tentar novamente em alguns minutos.','bg-rose-50 border-rose-300 text-rose-800'); return; }
      if(status==='pending'){ showBanner('Estamos preparando seu resultado personalizado. Em instantes voc√™ poder√° acessar.','bg-amber-50 border-amber-300 text-amber-800'); }
    })();

    // Bot√£o rever
    $('btnReview').addEventListener('click', function(e){ e.preventDefault(); $('resultado').classList.add('hidden'); $('quiz').classList.remove('hidden'); gotoStep(Math.min(current, QUESTIONS.length-1)); });

    // Inicializa√ß√£o
    $('year').textContent=(new Date()).getFullYear();
    loadProgress();
    renderQuestions();
    if(current>0){
      for(var i=0;i<current;i++){
        var prev = form.querySelector('.step[data-step="'+i+'"]'); if(prev) prev.classList.add('hidden');
      }
      var on = form.querySelector('.step[data-step="'+current+'"]'); if(on) on.classList.remove('hidden');
      updateProgress();
      scrollToQuizTop();
      showImcChip();
    }
  })();
  </script>
</body>
</html>
