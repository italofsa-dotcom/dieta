<!DOCTYPE html>
<html lang="pt-BR">
<head>

  <!-- Google tag (gtag.js) --> 
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17661147688"></script> 
  <script> 
    window.dataLayer = window.dataLayer || []; 
    function gtag(){dataLayer.push(arguments);} 
    gtag('js', new Date()); 
    gtag('config', 'AW-17661147688');
  </script>

  <!-- Start of Zendesk Widget script -->
  <script id="ze-snippet" src="https://static.zdassets.com/ekr/snippet.js?key=8bd1b71a-ff84-437d-a53b-3af6d91d14a8"> </script>
  <!-- End of Zendesk Widget script -->

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üß† Descubra qual dieta funciona pro seu tipo de corpo</title>
  <meta name="description" content="Quiz interativo que indica a dieta ideal para o seu biotipo. Inclui c√°lculo de IMC, 16 combina√ß√µes Dieta√óBiotipo, WhatsApp e salvamento de lead em MySQL (cPanel).">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root { --brand: #22c55e; }
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Liberation Sans', sans-serif; }
    .container { max-width: 980px; }
    .shadow-soft { box-shadow: 0 10px 25px rgba(2, 6, 23, 0.08); }
    .hidden { display: none !important; }

    fieldset.step {
      position: relative;
      background: linear-gradient(135deg, #d1fae5, #a7f3d0);
      border-radius: 20px;
      padding: 28px 20px 20px 20px;
      border: 1px solid #6ee7b7;
      box-shadow: 0 8px 24px rgba(16, 185, 129, 0.20);
      transition: transform .2s ease, box-shadow .2s ease;
    }
    fieldset.step:hover { transform: scale(1.01); box-shadow: 0 10px 28px rgba(5, 150, 105, 0.25); }
    fieldset.step legend { font-size: 1.25rem; font-weight: 800; color: #064e3b; margin-bottom: 10px; padding: 0 4px; }

    .choice label {
      background: #ffffff; border: 1.5px solid #e5e7eb; color: #0f172a; border-radius: 12px;
      transition: transform .16s ease, box-shadow .16s ease, border-color .16s ease;
      box-shadow: 0 4px 14px rgba(2, 6, 23, 0.06); display: block; padding: 12px; cursor: pointer;
    }
    .choice label:hover { transform: translateY(-1px); box-shadow: 0 8px 18px rgba(2, 6, 23, 0.10); border-color: #cbd5e1; }
    .choice input:checked + label { border-color: #10b981; box-shadow: 0 10px 24px rgba(16, 185, 129, 0.25); }

    .body-card { 
      background:#fff; border:1.5px solid #e5e7eb; border-radius:14px; padding:14px; text-align:center;
      cursor:pointer; transition: transform .16s ease, box-shadow .16s ease, border-color .16s ease; 
      box-shadow: 0 4px 14px rgba(2, 6, 23, 0.06); 
    }
    .body-card:hover { transform: translateY(-1px); box-shadow: 0 8px 18px rgba(2, 6, 23, 0.10); border-color:#cbd5e1; }
    .body-card.selected { border-color:#10b981; box-shadow: 0 10px 24px rgba(16, 185, 129, 0.25); }

    .imc-chip { display:inline-block; padding:4px 10px; border-radius:999px; font-size:.85rem; font-weight:700; }
  </style>
</head>

<body class="bg-slate-50 text-slate-900">

<!-- ================= HEADER ================= -->
<header class="bg-white border-b border-slate-200 sticky top-0 z-40">
  <div class="container mx-auto px-4 py-3 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <div class="h-9 w-9 rounded-2xl bg-[var(--brand)]/10 flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-[var(--brand)]">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6v6l4 2"/>
        </svg>
      </div>
      <span class="font-extrabold tracking-tight">Quiz de Dieta</span>
    </div>

    <nav class="hidden md:flex gap-6 text-sm text-slate-600">
      <a href="#quiz" class="hover:text-slate-900">Quiz</a>
      <a href="#resultado" class="hover:text-slate-900">Resultado</a>
    </nav>

    <a href="#quiz" class="rounded-xl px-4 py-2 bg-[var(--brand)] text-white font-semibold hover:bg-emerald-600 transition">
      Come√ßar
    </a>
  </div>
</header>

<!-- ================= HERO ================= -->
<section class="bg-gradient-to-b from-white to-slate-100">
  <div class="container mx-auto px-4 py-10 grid lg:grid-cols-2 gap-10 items-center">
    <div>
      <h1 class="text-3xl md:text-5xl font-extrabold leading-tight">üß† Descubra agora qual a dieta que realmente funciona com seu corpo!</h1>
      <p class="mt-4 text-lg text-slate-600">
        Tenha sua Dieta 100% Personalizada: Inteligente, Feita pro SEU Corpo ‚Äì Resultados Reais, Sem Promessas Falsas!
      </p>

      <div class="mt-6 flex gap-3">
        <a href="#quiz" class="rounded-xl px-6 py-3 bg-[var(--brand)] text-white font-semibold hover:bg-emerald-600 transition">Come√ßar agora</a>
        <span class="text-slate-500 self-center">Leva ~1 minuto</span>
      </div>
    </div>

    <div class="relative">
      <div class="rounded-2xl overflow-hidden shadow-soft border border-slate-200 bg-white">
        <img src="https://images.unsplash.com/photo-1544025162-d76694265947?q=80&w=1600&auto=format&fit=crop" class="w-full h-72 object-cover"/>
        <div class="p-6">
          <h3 class="text-xl font-bold">Resultado personalizado</h3>
          <p class="mt-1 text-slate-600">Direcionamento claro combinando biotipo, IMC e perfil.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ================= QUIZ ================= -->
<section id="quiz" class="py-10 bg-white border-t border-b border-slate-200">
  <div class="container mx-auto px-4">
    <div class="p-6 rounded-2xl bg-white border border-slate-200 shadow-soft">

      <div id="statusBanner" class="hidden mb-4 rounded-xl px-4 py-3 text-sm border"></div>

      <div class="flex items-center justify-between mb-4">
        <div>
          <h2 class="text-2xl font-extrabold">Responda √†s perguntas</h2>
          <p id="microcopy" class="text-slate-600 text-sm mt-1">Come√ßamos entendendo sua rotina üòâ</p>
        </div>

        <div class="w-52 text-right">
          <div class="h-2 rounded-full bg-slate-200 overflow-hidden">
            <div id="progress" class="h-2 bg-[var(--brand)] w-0"></div>
          </div>
          <p class="text-xs text-slate-500 mt-1">
            <span id="progressCount">0/20</span> ‚Ä¢ <span id="pct">0%</span>
          </p>
        </div>
      </div>

      <form id="quizForm" class="grid gap-6">
        <noscript>Ative o JavaScript para visualizar as perguntas do quiz.</noscript>
      </form>

      <div class="mt-6 flex items-center justify-between">
        <button id="btnPrev" class="rounded-xl px-4 py-2 border border-slate-300 font-semibold disabled:opacity-40" disabled>
          Voltar
        </button>
      </div>

    </div>
  </div>
</section>

<!-- ================= RESULTADO ================= -->
<section id="resultado" class="py-12 hidden">
  <div class="container mx-auto px-4">
    <div class="p-6 rounded-2xl bg-white border border-slate-200 shadow-soft">

      <p class="text-sm text-slate-500">Seu resultado</p>
      <h2 id="resultTitle" class="text-2xl md:text-3xl font-extrabold"></h2>
      <p id="resultDesc" class="mt-2 text-slate-700"></p>

      <div class="mt-6 p-5 rounded-2xl bg-emerald-50 border border-emerald-200">
        <h2 class="font-bold">Receba AGORA seu plano COMPLETO e personalizado no WhatsApp</h2>
        <p class="text-slate-700 mt-1">Preencha seus dados abaixo e receba imediatamente!</p>

        <form id="leadForm" class="mt-3 grid md:grid-cols-4 gap-3" onsubmit="return handleLead(event)">
          <input id="nome" type="text" required placeholder="Seu nome" class="rounded-xl border-slate-300" />
          <input id="email" type="email" required placeholder="Seu e-mail" class="rounded-xl border-slate-300"
                 autocomplete="email" inputmode="email" autocapitalize="none" autocorrect="off" spellcheck="false" />
          <input id="whats" type="tel" required inputmode="tel" placeholder="(61) 9 9999-9999" class="rounded-xl border-slate-300" />
          <button class="rounded-xl px-6 py-3 bg-[var(--brand)] text-white font-semibold">Continuar</button>
        </form>

        <p id="leadOk" class="hidden text-emerald-700 text-sm mt-2">Quase l√°! Preparando sua p√°gina‚Ä¶</p>
      </div>

      <div class="mt-6 grid md:grid-cols-2 gap-6">
        <div class="p-5 rounded-2xl border border-slate-200">
          <h3 class="font-bold">Sugest√µes pr√°ticas</h3>
          <ul id="tips" class="mt-2 list-disc list-inside text-slate-700 space-y-1"></ul>
        </div>

        <div class="p-5 rounded-2xl border border-slate-200">
          <h3 class="font-bold">Mini card√°pio (exemplo)</h3>
          <ul id="menu" class="mt-2 list-disc list-inside text-slate-700 space-y-1"></ul>
        </div>
      </div>

      <div class="mt-4">
        <button id="btnReview" class="rounded-xl px-4 py-2 border border-slate-300 font-semibold">
          Rever respostas
        </button>
      </div>

    </div>
  </div>
</section>

<!-- ================= FOOTER ================= -->
<footer class="py-10 text-center text-sm text-slate-500">
  <p>¬© <span id="year"></span> Dieta Pronta Online. Todos os direitos reservados.</p>
</footer>

<!-- ================= SCRIPT DO QUIZ ================= -->
<script>
(function(){

  /* ===================== CONFIG ===================== */

  var PRE_PAG_URL   = "/pre-pagamento/";
  var LEAD_ENDPOINT = "https://italomelo.com/server/save_lead.php";
  var LEAD_TOKEN    = "2a8e5cda3b49e2f6f72dc0d4a1f9f83e9c0fda8b2f7a3e1c4d6b9e7f5a2c1d8e";

  /* =========== LISTA DE BIOTIPOS MASCULINOS ========== */
  var BODY_MALE = [
    { key:'ECTO', name:'Ectomorfo Masculino', image:'img/male_ecto.png' },
    { key:'MESO', name:'Mesomorfo Masculino', image:'img/male_meso.png' },
    { key:'ENDO', name:'Endomorfo Masculino', image:'img/male_endo.png' },
    { key:'EQUI', name:'Equilibrado Masculino', image:'img/male_equi.png' }
  ];

  /* =========== LISTA DE BIOTIPOS FEMININOS =========== */
  var BODY_FEMALE = [
    { key:'ECTO', name:'Ectomorfa Feminina', image:'img/female_ecto.png' },
    { key:'MESO', name:'Mesomorfa Feminina', image:'img/female_meso.png' },
    { key:'ENDO', name:'Endomorfa Feminina', image:'img/female_endo.png' },
    { key:'EQUI', name:'Equilibrada Feminina', image:'img/female_equi.png' }
  ];

  /* Lista din√¢mica atual (ser√° atualizada ap√≥s g√™nero) */
  var CURRENT_BODY_TYPES = BODY_MALE;

  /* ================== MICROCOPY & MODELOS ============ */
  var MICROCOPY = {
    0:  "Come√ßamos entendendo sua rotina. Dica: responda com sinceridade üòâ",
    4:  "√ìtimo! J√° conseguimos captar seu ritmo. Continuando‚Ä¶",
    8:  "Metade do caminho! Essas pr√≥ximas ajudam a refinar seu perfil.",
    12: "Estamos quase l√°. Ajustes finos fazem diferen√ßa.",
    16: "Seu plano est√° praticamente pronto. √öltimos detalhes!"
  };

  var PROFILES = {
    A:{title:"ü•ë Low Carb / Cetog√™nica",desc:"Foco em prote√≠nas magras, gorduras boas e carboidratos bem controlados.",tips:["Priorize ovos, peixes, carnes magras, abacate e azeite","Troque refrigerantes por √°gua com lim√£o","Inclua fibras (verduras, legumes) para saciedade"],menu:["Caf√©: omelete com queijo + abacate","Almo√ßo: frango grelhado + salada com azeite","Jantar: salm√£o + legumes salteados"]},
    B:{title:"üçö Balanceada / Mediterr√¢nea",desc:"Equil√≠brio entre carboidratos complexos, prote√≠nas e gorduras boas.",tips:["Prato colorido e variado","Gr√£os integrais, frutas e verduras","Azeite e oleaginosas com modera√ß√£o"],menu:["Caf√©: iogurte + granola + frutas","Almo√ßo: arroz integral, feij√£o, peixe e salada","Jantar: sopa de legumes + frango desfiado"]},
    C:{title:"ü•© Proteica / Hiperproteica",desc:"Alta ingest√£o de prote√≠na com carboidratos ajustados para defini√ß√£o e manuten√ß√£o de massa magra.",tips:["Fonte proteica em todas as refei√ß√µes","Whey/Prote√≠na com orienta√ß√£o profissional","Hidrate-se e ajuste fibras"],menu:["Caf√©: ovos mexidos + queijo branco","Almo√ßo: patinho + salada + quinoa","Jantar: omelete de claras + legumes"]},
    D:{title:"üïí Jejum Intermitente / Flex√≠vel",desc:"Janelas de alimenta√ß√£o bem definidas, sem exageros nas quebras do jejum.",tips:["Defina janela (ex.: 16/8) com orienta√ß√£o","Prote√≠nas e fibras na primeira refei√ß√£o","√Ågua, caf√© sem a√ß√∫car e ch√°s no jejum"],menu:["1¬™ refei√ß√£o: bowl proteico (iogurte grego + nuts)","2¬™: frango + legumes + arroz integral","3¬™ (opcional): sopa de legumes + ovos"]}
  };
  /* ================= COMBINA√á√ïES FINAL ================= */
  var COMBOS = {
    'A-ECTO': { title:'Plano Ectomorfo Low Carb', desc:'Estrat√©gia para reduzir gordura sem perder performance.' },
    'A-MESO': { title:'Plano Mesomorfo Low Carb', desc:'Foco em defini√ß√£o e estabilidade energ√©tica.' },
    'A-ENDO': { title:'Plano Endomorfo Low Carb', desc:'Controle glic√™mico e foco em saciedade.' },
    'A-EQUI': { title:'Plano Equilibrado Low Carb', desc:'Abordagem leve, sustent√°vel e flex√≠vel.' },

    'B-ECTO': { title:'Plano Ectomorfo Balanceado', desc:'Mais carboidratos complexos e densidade nutritiva.' },
    'B-MESO': { title:'Plano Mesomorfo Balanceado', desc:'Distribui√ß√£o harm√¥nica de macros.' },
    'B-ENDO': { title:'Plano Endomorfo Balanceado', desc:'Controle de por√ß√µes e integrais.' },
    'B-EQUI': { title:'Plano Equilibrado Mediterr√¢neo', desc:'Variedade, sabor e boa sa√∫de.' },

    'C-ECTO': { title:'Plano Ectomorfo Proteico', desc:'Prote√≠na alta e carbo moderado.' },
    'C-MESO': { title:'Plano Mesomorfo Proteico', desc:'Alta saciedade e foco em massa magra.' },
    'C-ENDO': { title:'Plano Endomorfo Proteico', desc:'Redu√ß√£o de gordura com mais fibras.' },
    'C-EQUI': { title:'Plano Equilibrado Proteico', desc:'Simples, pr√°tico e saciante.' },

    'D-ECTO': { title:'Plano Ectomorfo Jejum Flex√≠vel', desc:'Aten√ß√£o especial √† ingest√£o proteica.' },
    'D-MESO': { title:'Plano Mesomorfo Jejum Flex√≠vel', desc:'Controle cal√≥rico simples e eficiente.' },
    'D-ENDO': { title:'Plano Endomorfo Jejum Flex√≠vel', desc:'Ajuda a controlar apetite e compuls√£o.' },
    'D-EQUI': { title:'Plano Equilibrado Jejum Flex√≠vel', desc:'Sustent√°vel e funcional.' }
  };

  /* ===================== PERGUNTAS ===================== */
  var QUESTIONS = [
    {type:'radio', q:"Vamos come√ßar.. informe seu g√™nero", a:["HOMEM","MULHER"]},
    {type:'radio', q:"Qual sua faixa et√°ria?", a:["15 a 25 anos","26 a 35 anos","36 a 49 anos","+50 anos"]},
    {type:'radio', q:"Qual seu principal objetivo agora?", a:["Emagrecer r√°pido","Ganhar massa magra","Manter peso","Reduzir gordura localizada"]},
    {type:'radio', q:"Seu n√≠vel de energia di√°rio √©‚Ä¶", a:["Sempre cansado","Oscila muito","Constante","Muito alto"]},
    {type:'radio', q:"Seu apetite ao longo do dia √©‚Ä¶", a:["Forte de manh√£","Mais fome √† noite","Pouco apetite","Muita fome o tempo todo"]},
    {type:'radio', q:"Quantas refei√ß√µes principais por dia?", a:["2 ou menos","3","4 a 5","Mais de 5 pequenas"]},
    {type:'radio', q:"Fome emocional/ansiosa?", a:["Sim, muito","√Äs vezes","Raramente","Nunca"]},
    {type:'radio', q:"N√≠vel de atividade f√≠sica", a:["Sedent√°rio","Leve","Moderado (3x/sem)","Intenso (5x+)"]},
    {type:'radio', q:"Seu sono √©‚Ä¶", a:["Ruim","Durmo bem mas acordo cansado","Regular","Muito bom"]},
    {type:'radio', q:"Costuma pular o caf√© da manh√£?", a:["Sempre","√Äs vezes","Raramente","Nunca"]},
    {type:'radio', q:"Seu estilo de alimenta√ß√£o atual", a:["Muito carboidrato","Equilibrada","Rica em prote√≠na","Desorganizada"]},
    {type:'radio', q:"Vontade de doces", a:["Sempre","√Äs vezes","Raramente","Quase nunca"]},
    {type:'radio', q:"Rea√ß√£o aos carboidratos", a:["Engordo r√°pido","Sem efeito","D√° energia","Fico inchado"]},
    {type:'radio', q:"Prefere refei√ß√µes‚Ä¶", a:["Leves e frequentes","Poucas e completas","Grandes √† noite","Equilibradas"]},
    {type:'radio', q:"Consegue ficar longos per√≠odos sem comer?", a:["Sim, tranquilo","Pouco tempo","Depende do dia","N√£o consigo"]},
    {type:'radio', q:"N√≠vel de organiza√ß√£o das refei√ß√µes", a:["Planejo tudo","Planejo parte","Improviso muito","Quase nunca penso nisso"]},
    {type:'input-height', q:"Qual a sua altura? (em cent√≠metros)", placeholder:"Ex.: 173"},
    {type:'input-weight', q:"Qual o seu peso atual? (em kg)", placeholder:"Ex.: 78"},
    {type:'body', q:"Agora escolha seu tipo de corpo (biotipo)", a: CURRENT_BODY_TYPES},
    {type:'radio', q:"Como √© sua rotina durante a semana?", a:["Muito corrida","Organizada","Flex√≠vel","Muito sedent√°ria"]},
    {type:'radio', q:"Qual frase te representa?", a:["Quero resultados r√°pidos","Prefiro algo sustent√°vel","Quero perder peso comendo bem","Quero performance m√°xima"]}
  ];

  /* ================= VARI√ÅVEIS GERAIS ================= */
  var selected     = new Array(QUESTIONS.length).fill(null);
  var scores       = {A:0,B:0,C:0,D:0};
  var current      = 0;
  var heightCm     = null;
  var weightKg     = null;
  var imcValue     = null;
  var imcLabel     = '';
  var bodyTypeKey  = null;
  var selectedGender = null;

  /* ================= HELPERS ================= */
  function $(id){ return document.getElementById(id); }

  var form = $("quizForm");

  /* ================= RENDERIZAR PERGUNTAS ================= */
  function renderQuestions(){

    // Atualiza lista de biotipo conforme g√™nero
    QUESTIONS[18].a = CURRENT_BODY_TYPES;

    var html = "";

    for(var i=0;i<QUESTIONS.length;i++){
      var it = QUESTIONS[i];

      html += '<fieldset data-step="'+i+'" class="step'+(i===0?'':' hidden')+'">';
      html += '<legend>'+(i+1)+'. '+ it.q +'</legend>';

      /* RADIO */
      if(it.type === 'radio'){
        html += '<div class="mt-3 grid sm:grid-cols-2 gap-3">';
        for(var j=0;j<it.a.length;j++){
          var letter = String.fromCharCode(65+j);
          var id = "q"+i+"_"+letter;

          html += `
            <div class="choice">
              <input class="peer hidden" type="radio" id="${id}" name="q${i}" value="${letter}" required />
              <label for="${id}" class="block text-[1.05rem]">${it.a[j]}</label>
            </div>`;
        }
        html += '</div>';
      }

      /* ALTURA */
      else if(it.type === 'input-height'){
        var v = heightCm!=null ? String(heightCm):"";
        html += `
          <div class="mt-2">
            <input id="heightCm" type="number" min="120" max="230" step="1"
              value="${v}" placeholder="${it.placeholder}"
              class="rounded-xl border-slate-300 w-full p-3" />
            <p class="text-xs text-slate-600 mt-2">Use cent√≠metros. Ex.: 173</p>
          </div>`;
      }

      /* PESO */
      else if(it.type === 'input-weight'){
        var wv = weightKg!=null ? String(weightKg):"";
        html += `
          <div class="mt-2">
            <input id="weightKg" type="number" min="35" max="250" step="0.1"
              value="${wv}" placeholder="${it.placeholder}"
              class="rounded-xl border-slate-300 w-full p-3" />
            <p class="text-xs text-slate-600 mt-2">Use quilogramas. Ex.: 78.5</p>
          </div>`;
      }

      /* BIOTIPOS COM IMAGENS */
      else if(it.type === 'body'){
        html += `<div class="mt-3 grid sm:grid-cols-2 md:grid-cols-4 gap-3">`;
        for(var b=0; b<it.a.length; b++){
          var bt = it.a[b];
          var selectedClass = (bodyTypeKey === bt.key ? " selected" : "");

          html += `
            <div class="body-card${selectedClass}" data-body="${bt.key}">
              <img src="${bt.image}" class="mx-auto h-32 w-auto rounded-lg" />
              <div class="mt-2 font-semibold">${bt.name}</div>
            </div>`;
        }
        html += `</div>`;
      }

      html += '</fieldset>';
    }

    form.innerHTML = html;
  }
  /* =================== EVENTOS =================== */

 // Selecionou g√™nero ‚Üí troca body-types e avan√ßa
document.addEventListener("change", function(e){
  const t = e.target;
  if(!t) return;

  // S√≥ dispara na pergunta 0
  if(t.type === "radio" && t.name === "q0"){  

    // A = letra da op√ß√£o (primeira op√ß√£o)
    // Precisamos ler o texto correto (HOMEM ou MULHER)
    const label = t.nextElementSibling?.innerText?.trim() || "";

    if(label.toUpperCase() === "HOMEM"){
      selectedGender = "HOMEM";
      CURRENT_BODY_TYPES = BODY_TYPES_MASC;
    } else {
      selectedGender = "MULHER";
      CURRENT_BODY_TYPES = BODY_TYPES_FEM;
    }

    // Atualiza o item de biotipo com a lista correta
    QUESTIONS[18].a = CURRENT_BODY_TYPES;

    // Re-renderiza
    renderQuestions();

    // Avan√ßa automaticamente
    setTimeout(()=> nextStep(), 50);
  }
});

  // Avan√ßo autom√°tico para qualquer pergunta radio
  document.addEventListener("change", function(e){
    const t = e.target;
    if(!t) return;
    if(t.type === "radio" && t.name.startsWith("q")){
      const fs = t.closest("fieldset.step");
      if(!fs) return;
      const idx = parseInt(fs.dataset.step, 10);
      selected[idx] = t.value;
      saveProgress();
      setTimeout(()=> nextStep(), 120);
    }
  });

  // Altura ‚Üí calcula IMC ‚Üí avan√ßa
  document.addEventListener("input", function(e){
    if(e.target.id === "heightCm"){
      const v = parseInt(e.target.value,10);
      heightCm = (!isNaN(v) ? v : null);
      imcCompute();
    }
    if(e.target.id === "weightKg"){
      const v = parseFloat(e.target.value);
      weightKg = (!isNaN(v) ? v : null);
      imcCompute();
    }
  });

  document.addEventListener("change", function(e){
    if(e.target.id === "heightCm" && heightCm >=120 && heightCm<=230){
      setTimeout(()=> nextStep(),120);
    }
    if(e.target.id === "weightKg" && weightKg >=35 && weightKg<=250){
      setTimeout(()=> nextStep(),120);
    }
  });

  // Clique em biotipo
  form.addEventListener("click", function(e){
    const card = e.target.closest(".body-card");
    if(!card) return;
    bodyTypeKey = card.dataset.body;

    form.querySelectorAll(".body-card").forEach(c=>c.classList.remove("selected"));
    card.classList.add("selected");

    setTimeout(()=> nextStep(), 120);
  });

  // Bot√£o voltar
  $("btnPrev").addEventListener("click", function(e){
    e.preventDefault();
    prevStep();
  });

  /* ================== RESULTADO ================== */

  function recomputeScores(){
    scores.A = scores.B = scores.C = scores.D = 0;

    for(let i=0;i<selected.length;i++){
      const v = selected[i];
      if(!v) continue;
      if(scores[v] != null) scores[v]++;
    }

    if(imcValue != null){
      if(imcValue >=25){ scores.A++; scores.C++; }
      if(imcValue <18.5){ scores.B++; scores.C++; }
    }
  }

  function showResult(){
    recomputeScores();
    const keys = Object.keys(scores);
    let best = keys[0];
    for(let k of keys){
      if(scores[k] > scores[best]) best = k;
    }

    const body = bodyTypeKey || "EQUI";
    const combo = COMBOS[ best + "-" + body ] || {title:"Plano Personalizado", desc:"Seu plano foi calculado."};

    $("resultTitle").textContent = combo.title;
    $("resultDesc").textContent  = combo.desc;

    $("resultado").classList.remove("hidden");
    $("quiz").classList.add("hidden");
  }

  /* ================== SALVAR LEAD ================== */

  async function salvarLead(data){
    const fd = new FormData();
    fd.append("token", LEAD_TOKEN);
    fd.append("ref", data.ref);
    fd.append("name", data.nome);
    fd.append("email", data.email);
    fd.append("phone", data.whats);

    try{
      await fetch(LEAD_ENDPOINT, { method:"POST", body: fd });
    }catch{}
  }

  function uuid(){
    return "ref-" + Date.now() + "-" + Math.random().toString(36).slice(2,8);
  }

  window.handleLead = async function(e){
    e.preventDefault();
    const nome  = $("nome").value.trim();
    const email = $("email").value.trim();
    const whats = $("whats").value.trim();

    $("leadOk").classList.remove("hidden");

    const ref = uuid();
    await salvarLead({ ref, nome, email, whats });

    const url = new URL(PRE_PAG_URL, location.origin);
    url.searchParams.set("ref", ref);
    url.searchParams.set("nome", nome);
    url.searchParams.set("email", email);
    url.searchParams.set("whats", whats);

    location.href = url.toString();
    return false;
  };

  /* =============== FINALIZA√á√ÉO =============== */

  renderQuestions();
  updateProgress();

})();
</script>

</body>
</html>


