<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üß† Descubra qual dieta funciona pro seu tipo de corpo (em 1 minuto!)</title>
  <meta name="description" content="Quiz interativo com 15 perguntas que identifica o melhor tipo de dieta para o seu perfil. Resultado com recomenda√ß√µes + WhatsApp + pagamento integrado." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Mercado Pago SDK -->
  <script src="https://sdk.mercadopago.com/js/v2"></script>
  <style>
    :root { --brand: #22c55e; }
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Liberation Sans', sans-serif; }
    .container { max-width: 980px; }
    .shadow-soft { box-shadow: 0 10px 25px rgba(2, 6, 23, 0.08); }
    #popupPagamento { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); backdrop-filter:blur(3px); z-index:1000; }
    .hidden { display: none !important; }

    /* ===== BOX da pergunta (degrad√™ verde) ===== */
    fieldset.step {
      position: relative;
      background: linear-gradient(135deg, #d1fae5, #a7f3d0);
      border-radius: 20px;
      padding: 28px 20px 20px 20px; /* espa√ßo extra no topo p/ legend */
      border: 1px solid #6ee7b7;
      box-shadow: 0 8px 24px rgba(16, 185, 129, 0.20);
      transition: transform .2s ease, box-shadow .2s ease;
    }
    fieldset.step:hover {
      transform: scale(1.01);
      box-shadow: 0 10px 28px rgba(5, 150, 105, 0.25);
    }
    fieldset.step legend {
      position: relative;
      background: none;
      font-size: 1.25rem;
      font-weight: 700;
      color: #064e3b;
      margin-bottom: 10px;
      padding: 0 4px;
    }

    /* ===== Op√ß√µes (respostas) em branco ===== */
    .choice label {
      background: #ffffff;
      border: 1.5px solid #e5e7eb;
      color: #0f172a;
      border-radius: 12px;
      transition: transform .16s ease, box-shadow .16s ease, border-color .16s ease;
      box-shadow: 0 4px 14px rgba(2, 6, 23, 0.06);
      display: block;
      padding: 12px;
      cursor: pointer;
    }
    .choice label:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 18px rgba(2, 6, 23, 0.10);
      border-color: #cbd5e1;
    }
    .choice input:checked + label {
      border-color: #10b981;
      box-shadow: 0 10px 24px rgba(16, 185, 129, 0.25);
    }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">
  <!-- Header -->
  <header class="bg-white border-b border-slate-200 sticky top-0 z-40">
    <div class="container mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="h-9 w-9 rounded-2xl bg-[var(--brand)]/10 flex items-center justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5 text-[var(--brand)]"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6v6l4 2"/></svg>
        </div>
        <span class="font-extrabold tracking-tight">Quiz de Dieta</span>
      </div>
      <nav class="hidden md:flex gap-6 text-sm text-slate-600">
        <a href="#como-funciona" class="hover:text-slate-900">Como funciona</a>
        <a href="#quiz" class="hover:text-slate-900">Quiz</a>
        <a href="#resultado" class="hover:text-slate-900">Resultado</a>
      </nav>
      <a href="#quiz" class="rounded-xl px-4 py-2 bg-[var(--brand)] text-white font-semibold hover:bg-emerald-600 transition">Come√ßar</a>
    </div>
  </header>

  <!-- Hero -->
  <section class="bg-gradient-to-b from-white to-slate-100">
    <div class="container mx-auto px-4 py-12 grid lg:grid-cols-2 gap-10 items-center">
      <div>
        <h1 class="text-3xl md:text-5xl font-extrabold leading-tight">üß† Descubra qual dieta realmente funciona pro seu tipo de corpo <span class="whitespace-nowrap">(em 1 minuto!)</span></h1>
        <p class="mt-4 text-lg text-slate-600">Responda 15 perguntas r√°pidas e receba um plano de dieta recomendado para o seu perfil ‚Äî com dicas e a op√ß√£o de receber tudo no WhatsApp. Para destravar o plano completo, h√° uma taxa simb√≥lica de <strong>R$ 9,90</strong>.</p>
        <div class="mt-6 flex gap-3">
          <a href="#quiz" class="rounded-xl px-6 py-3 bg-[var(--brand)] text-white font-semibold hover:bg-emerald-600 transition">Come√ßar agora</a>
          <a href="#como-funciona" class="rounded-2xl px-6 py-3 border border-slate-300 font-semibold hover:bg-white transition">Como funciona</a>
        </div>
        <p class="mt-3 text-sm text-slate-500">‚ö†Ô∏è Conte√∫do informativo. Para condi√ß√µes de sa√∫de, procure um profissional.</p>
      </div>
      <div class="relative">
        <div class="rounded-2xl overflow-hidden shadow-soft border border-slate-200 bg-white">
          <img src="https://images.unsplash.com/photo-1544025162-d76694265947?q=80&w=1600&auto=format&fit=crop" alt="Comida saud√°vel" class="w-full h-72 object-cover"/>
          <div class="p-6">
            <h3 class="text-xl font-bold">Resultado personalizado</h3>
            <p class="mt-1 text-slate-600">Receba a melhor estrat√©gia entre: Low Carb/Cetog√™nica, Balanceada/Mediterr√¢nea, Proteica/Hiperproteica ou Jejum Intermitente/Flex√≠vel.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Como funciona -->
  <section id="como-funciona" class="py-10">
    <div class="container mx-auto px-4">
      <h2 class="text-2xl md:text-3xl font-extrabold">Como funciona</h2>
      <div class="mt-6 grid md:grid-cols-3 gap-6">
        <div class="p-6 rounded-2xl border border-slate-200 bg-white shadow-soft">
          <p class="text-sm text-slate-500">1 de 3</p>
          <h3 class="font-bold mt-1">Responda 15 perguntas</h3>
          <p class="mt-2 text-slate-600">Leva cerca de 1 minuto. Suas respostas indicam seu perfil metab√≥lico e comportamental.</p>
        </div>
        <div class="p-6 rounded-2xl border border-slate-200 bg-white shadow-soft">
          <p class="text-sm text-slate-500">2 de 3</p>
          <h3 class="font-bold mt-1">Veja seu resultado</h3>
          <p class="mt-2 text-slate-600">Mostramos a dieta recomendada para o seu tipo de corpo, com dicas e macetes pr√°ticos.</p>
        </div>
        <div class="p-6 rounded-2xl border border-slate-200 bg-white shadow-soft">
          <p class="text-sm text-slate-500">3 de 3</p>
          <h3 class="font-bold mt-1">Destrave o plano completo</h3>
          <p class="mt-2 text-slate-600">Por R$ 9,90 voc√™ recebe o plano detalhado no WhatsApp e e-mail.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Quiz -->
  <section id="quiz" class="py-10 bg-white border-t border-b border-slate-200">
    <div class="container mx-auto px-4">
      <div class="p-6 rounded-2xl bg-white border border-slate-200 shadow-soft">

        <!-- Banner de status -->
        <div id="statusBanner" class="hidden mb-4 rounded-xl px-4 py-3 text-sm border"></div>

        <div class="flex items-center justify-between mb-4">
          <h2 class="text-2xl font-extrabold">Responda √†s perguntas</h2>
          <div class="w-44">
            <div class="h-2 rounded-full bg-slate-200 overflow-hidden" aria-hidden="true">
              <div id="progress" class="h-2 bg-[var(--brand)] w-0"></div>
            </div>
            <p id="pct" class="text-xs text-right text-slate-500 mt-1">0%</p>
          </div>
        </div>

        <form id="quizForm" class="grid gap-6">
          <noscript>Ative o JavaScript para visualizar as perguntas do quiz.</noscript>
        </form>

        <div class="mt-6 flex items-center justify-between">
          <button id="btnPrev" class="rounded-xl px-4 py-2 border border-slate-300 font-semibold disabled:opacity-40" disabled>Voltar</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Resultado -->
  <section id="resultado" class="py-12 hidden">
    <div class="container mx-auto px-4">
      <div class="p-6 rounded-2xl bg-white border border-slate-200 shadow-soft">
        <p class="text-sm text-slate-500">Seu resultado</p>
        <h2 id="resultTitle" class="text-2xl md:text-3xl font-extrabold"></h2>
        <p id="resultDesc" class="mt-2 text-slate-700"></p>

        <div class="mt-6 grid md:grid-cols-2 gap-6">
          <div class="p-5 rounded-2xl border border-slate-200">
            <h3 class="font-bold">Sugest√µes pr√°ticas</h3>
            <ul id="tips" class="mt-2 list-disc list-inside text-slate-700 space-y-1"></ul>
          </div>
          <div class="p-5 rounded-2xl border border-slate-200">
            <h3 class="font-bold">Mini card√°pio (exemplo)</h3>
            <ul id="menu" class="mt-2 list-disc list-inside text-slate-700 space-y-1"></ul>
          </div>
        </div>

        <div class="mt-6 p-5 rounded-2xl bg-emerald-50 border border-emerald-200">
          <h3 class="font-bold">Receba seu plano personalizado no WhatsApp</h3>
          <p class="text-slate-700 mt-1">Preencha seu nome e n√∫mero. Ap√≥s o pagamento de <strong>R$ 9,90</strong>, enviamos o plano completo.</p>
          <form id="leadForm" class="mt-3 grid md:grid-cols-3 gap-3" onsubmit="return handleLead(event)">
            <input id="nome" type="text" required placeholder="Seu nome" class="rounded-xl border-slate-300" />
            <input id="whats" type="tel" inputmode="tel" required placeholder="(61) 9 9999-9999" class="rounded-xl border-slate-300" />
            <button class="rounded-xl px-6 py-3 bg-[var(--brand)] text-white font-semibold">Continuar</button>
          </form>
          <p id="leadOk" class="hidden text-emerald-700 text-sm mt-2">Quase l√°! Abra o pagamento para liberar seu plano completo.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Popup Pagamento -->
  <div id="popupPagamento" class="flex items-center justify-center">
    <div class="bg-white p-6 rounded-2xl shadow-soft w-[90%] max-w-md text-center">
      <h2 class="text-2xl font-extrabold mb-2 text-[var(--brand)]">Pagamento R$ 9,90</h2>
      <p class="text-slate-700 mb-4">Finalize o pagamento para receber seu plano de dieta completo no WhatsApp.</p>
      <div id="mp-checkout" class="mb-3"></div>
      <button onclick="fecharPopup()" class="mt-1 text-slate-500 text-sm underline">Fechar</button>
      <p class="text-xs text-slate-400 mt-3">Pagamento processado pelo Mercado Pago. Aceitamos Pix, cart√£o e boleto.</p>
    </div>
  </div>

  <!-- Footer -->
  <footer class="py-10 text-center text-sm text-slate-500">
    <p>¬© <span id="year"></span> SuaMarca. Todos os direitos reservados.</p>
    <a href="#" class="underline">Pol√≠tica de Privacidade</a>
  </footer>

  <script>
  (function(){
    // ====== CONFIG ======
    var WHATS_NUMBER = "55619998514680";
    var MP_PUBLIC_KEY = "APP_USR-87cc4830-2ac4-410d-82b8-f295612a75b0";
    var MP_ENDPOINT = "https://dietapronta.online/api/mp-preference";

    // ====== PERFIS ======
    var PROFILES = {
      A: { title: "ü•ë Perfil A ‚Äî Low Carb / Cetog√™nica", desc: "Seu corpo tende a responder melhor a baixos carboidratos, priorizando prote√≠nas magras e gorduras boas. Controle a√ß√∫car e farinhas refinadas.", tips: ["Priorize ovos, peixes, carnes magras, abacate e azeite","Troque refrigerantes por √°gua com lim√£o","Monitore s√≥dio e ingest√£o de fibras"], menu: ["Caf√©: omelete com queijo + abacate","Almo√ßo: frango grelhado + salada com azeite","Jantar: salm√£o + legumes salteados"] },
      B: { title: "üçö Perfil B ‚Äî Balanceada / Mediterr√¢nea", desc: "Seu metabolismo pede equil√≠brio entre carboidratos complexos, prote√≠nas e gorduras boas. Foco em alimentos naturais e variedade.", tips: ["Monte pratos coloridos e variados","Prefira gr√£os integrais e frutas","Inclua azeite e oleaginosas com modera√ß√£o"], menu: ["Caf√©: iogurte + granola + frutas","Almo√ßo: arroz integral, feij√£o, fil√© de peixe e salada","Jantar: sopa de legumes + frango desfiado"] },
      C: { title: "ü•© Perfil C ‚Äî Proteica / Hiperproteica", desc: "Alta ingest√£o de prote√≠na com carboidratos ajustados favorece defini√ß√£o e manuten√ß√£o de massa magra.", tips: ["Inclua fonte proteica em todas as refei√ß√µes","Avalie uso de whey/prote√≠na conforme orienta√ß√£o profissional","Hidrate-se e ajuste fibras para o intestino funcionar bem"], menu: ["Caf√©: ovos mexidos + queijo branco","Almo√ßo: patinho grelhado + salada + quinoa","Jantar: omelete de claras + legumes"] },
      D: { title: "üïí Perfil D ‚Äî Jejum Intermitente / Flex√≠vel", desc: "Voc√™ lida bem com janelas de alimenta√ß√£o. Foque em refei√ß√µes completas e evite exageros nas quebras do jejum.", tips: ["Defina janela (ex.: 16/8) com profissional, se poss√≠vel","Priorize prote√≠nas e fibras na primeira refei√ß√£o","Beba √°gua, caf√© sem a√ß√∫car e ch√°s no jejum"], menu: ["Primeira refei√ß√£o: bowl proteico (iogurte grego + nuts)","Segunda: frango + legumes + arroz integral","Terceira (opcional): sopa de legumes + ovos"] }
    };

    // ====== PERGUNTAS ======
    var QUESTIONS = [
      { q: "Qual seu principal objetivo agora?", a: ["Emagrecer r√°pido","Ganhar massa magra","Manter peso e sa√∫de","Reduzir gordura localizada"] },
      { q: "Seu n√≠vel de energia di√°rio √©‚Ä¶", a: ["Sempre cansado","Oscila muito","Constante","Muito alto"] },
      { q: "Seu apetite ao longo do dia √©‚Ä¶", a: ["Forte de manh√£","Mais fome √† noite","Pouco apetite","Muita fome o tempo todo"] },
      { q: "Quantas refei√ß√µes principais por dia?", a: ["2 ou menos","3","4 a 5","Mais de 5 pequenas"] },
      { q: "Fome emocional/ansiosa?", a: ["Sim, muito","√Äs vezes","Raramente","Nunca"] },
      { q: "N√≠vel de atividade f√≠sica", a: ["Sedent√°rio","Leve","Moderado (3x/sem)","Intenso (5x+)"] },
      { q: "Seu sono √©‚Ä¶", a: ["Ruim","Durmo bem mas acordo cansado","Regular","Muito bom"] },
      { q: "Costuma pular o caf√© da manh√£?", a: ["Sempre","√Äs vezes","Raramente","Nunca"] },
      { q: "Seu estilo de alimenta√ß√£o atual", a: ["Muito carboidrato","Equilibrada","Rica em prote√≠na","Desorganizada"] },
      { q: "Vontade de doces", a: ["Sempre","√Äs vezes","Raramente","Quase nunca"] },
      { q: "Seu tipo de corpo", a: ["Ganha peso f√°cil","Dificuldade para ganhar peso","Oscila r√°pido","Equilibrado"] },
      { q: "Rea√ß√£o aos carboidratos", a: ["Engordo r√°pido","Sem efeito","D√° energia","Fico inchado"] },
      { q: "Prefere refei√ß√µes‚Ä¶", a: ["Leves e frequentes","Poucas e completas","Grandes √† noite","Equilibradas"] },
      { q: "Consegue ficar longos per√≠odos sem comer?", a: ["Sim, tranquilo","Pouco tempo","Depende do dia","N√£o consigo"] },
      { q: "Qual frase te representa?", a: ["Quero resultados r√°pidos","Prefiro algo sustent√°vel","Quero comer bem e perder peso","Quero performance m√°xima"] }
    ];

    // ====== ESTADO ======
    var selected = new Array(QUESTIONS.length); for(var si=0; si<selected.length; si++){ selected[si] = null; }
    var scores = { A:0, B:0, C:0, D:0 };
    var current = 0;

    function $(id){ return document.getElementById(id); }
    var form = $("quizForm");

    // ====== RENDER ======
    function renderQuestions(){
      try {
        var html = "";
        for(var i=0;i<QUESTIONS.length;i++){
          var item = QUESTIONS[i];
          html += '<fieldset data-step="'+i+'" class="step'+(i===0?'':' hidden')+'">';
          html += '<legend>'+(i+1)+'. '+ item.q +'</legend>';
          html += '<div class="mt-3 grid sm:grid-cols-2 gap-3">';
          for(var j=0;j<item.a.length;j++){
            var letter = String.fromCharCode(65+j);
            var id = "q"+i+"_"+letter;
            html += '<div class="choice">';
            html += '<input class="peer hidden" type="radio" id="'+id+'" name="q'+i+'" value="'+letter+'" required />';
            html += '<label for="'+id+'" class="block">'+ item.a[j] +'</label>';
            html += '</div>';
          }
          html += '</div></fieldset>';
        }
        form.innerHTML = html;
        updateProgress();
      } catch(e){
        console.error("[Quiz] Erro ao renderizar:", e);
      }
    }

    function recomputeScores(){
      scores.A = scores.B = scores.C = scores.D = 0;
      for(var i=0;i<selected.length;i++){ var v = selected[i]; if(v && scores[v] !== undefined){ scores[v]++; } }
    }

    function updateProgress(){
      var pct = Math.round((current)/QUESTIONS.length*100);
      $("progress").style.width = pct + "%";
      $("pct").textContent = pct + "%";
      $("btnPrev").disabled = (current === 0);
    }

    function gotoStep(n){
      var curEl = form.querySelector('.step[data-step="'+current+'"]');
      var nextEl = form.querySelector('.step[data-step="'+n+'"]');
      if(curEl) curEl.classList.add('hidden');
      if(nextEl) nextEl.classList.remove('hidden');
      current = n; updateProgress();
    }

    function nextStep(){
      if(current < QUESTIONS.length - 1){ gotoStep(current + 1); return; }
      $("quiz").classList.add("hidden"); showResult();
    }

    function prevStep(){ if(current>0){ gotoStep(current-1); } }

    function showResult(){
      var bestKey = "A"; var bestScore = -1;
      for(var k in scores){ if(scores[k] > bestScore){ bestScore = scores[k]; bestKey = k; } }
      var p = PROFILES[bestKey];
      $("resultTitle").textContent = p.title;
      $("resultDesc").textContent = p.desc;
      var tips = ""; for(var i=0;i<p.tips.length;i++){ tips += "<li>"+p.tips[i]+"</li>"; } $("tips").innerHTML = tips;
      var menu = ""; for(var j=0;j<p.menu.length;j++){ menu += "<li>"+p.menu[j]+"</li>"; } $("menu").innerHTML = menu;
      $("resultado").classList.remove("hidden");
      $("progress").style.width = "100%"; $("pct").textContent = "100%";
    }

    // Avan√ßo autom√°tico
    document.addEventListener("change", function(e){
      var t = e.target; if(!t || t.type !== "radio") return;
      var fs = t.closest("fieldset.step"); if(!fs) return;
      var idx = parseInt(fs.getAttribute("data-step"), 10);
      selected[idx] = t.value; recomputeScores();
      setTimeout(nextStep, 120);
    });

    // Voltar
    $("btnPrev").addEventListener("click", function(e){ e.preventDefault(); prevStep(); });

    // ====== PAGAMENTO ======

    // Gerador simples de external_reference
    function uuidRef(){
      return 'ref-' + Date.now() + '-' + Math.random().toString(36).slice(2,8);
    }

    function handleLead(e){
      e.preventDefault();
      $("leadOk").classList.remove("hidden");
      abrirPopupPagamento();
      return false;
    }
    window.handleLead = handleLead;

    function abrirPopupPagamento(){
      var popup = $("popupPagamento");
      popup.style.display = "flex";
      var container = $("mp-checkout");
      container.innerHTML = "";

      var mp = new MercadoPago(MP_PUBLIC_KEY, { locale: "pt-BR" });

      // 1) Criar external_reference √∫nico e salvar
      var ref = uuidRef();
      try { localStorage.setItem('mp_external_ref', ref); } catch(e){}

      // 2) Timeout de seguran√ßa
      var timeout = new Promise(function(_, rej){ setTimeout(function(){ rej(new Error('Timeout criando prefer√™ncia')); }, 12000); });

      // 3) Enviar ref ao backend
      var req = fetch(MP_ENDPOINT, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ valor: 1.90, titulo: "Plano de Dieta Completo", external_reference: ref })
      })
      .then(function(r){ return r.text().then(function(txt){ var data={}; try{data=JSON.parse(txt);}catch{} if(!r.ok) throw new Error("HTTP "+r.status+" "+txt); if(!data.id) throw new Error("Prefer√™ncia sem id: "+txt); return data; }); });

      Promise.race([timeout, req])
        .then(function(data){
          mp.checkout({ preference: { id: data.id }, render: { container: "#mp-checkout", label: "Pagar R$ 9,90" } });
          if(data.init_point){
            try { window.open(data.init_point, "_blank"); } catch(e){}
            var a = document.createElement("a");
            a.href = data.init_point; a.target = "_blank"; a.rel = "noopener";
            a.className = "block mt-3 text-sm underline";
            a.textContent = "‚ö†Ô∏è Se o bot√£o n√£o abrir, clique aqui para pagar";
            container.appendChild(a);
          }
        })
        .catch(function(err){
          console.error("[MP] Falha:", err);
          container.innerHTML = '<p class="text-sm text-red-600">N√£o foi poss√≠vel iniciar o pagamento agora. Tente novamente em alguns instantes.</p>';
        });
    }
    window.fecharPopup = function(){ $("popupPagamento").style.display = "none"; };

    function abrirWhatsAppComResultado(){
      var nome = $("nome").value.trim();
      var result = $("resultTitle").textContent;
      var desc = $("resultDesc").textContent;
      var texto = "Oi, sou " + nome + ". Meu resultado no Quiz de Dieta foi: " + result + ".\nResumo: " + desc + "\nPagamento confirmado. Quero receber meu plano completo.";
      var link = "https://wa.me/" + WHATS_NUMBER + "?text=" + encodeURIComponent(texto);
      window.open(link, "_blank");
    }

    // ====== DETEC√á√ÉO DE STATUS (approved/pending/failure) + POLLING ======
    (function detectarStatus(){
      var p = new URLSearchParams(location.search);
      var status = p.get("status");
      var banner = document.getElementById("statusBanner");

      function showBanner(texto, classes){
        banner.textContent = texto;
        banner.className = "mb-4 rounded-xl px-4 py-3 text-sm border " + classes;
        banner.classList.remove("hidden");
      }

      if(status === "approved"){
        if (window.fecharPopup) window.fecharPopup();
        setTimeout(abrirWhatsAppComResultado, 300);
        return;
      }

      if(status === "failure"){
        showBanner(
          "Pagamento n√£o aprovado. Voc√™ pode tentar novamente com Pix, outro cart√£o ou outro m√©todo.",
          "bg-rose-50 border-rose-300 text-rose-800"
        );
        return;
      }

      if(status === "pending"){
        showBanner(
          "Pagamento pendente. Se foi Pix, a confirma√ß√£o costuma sair em alguns minutos. Assim que for aprovado, liberamos seu plano.",
          "bg-amber-50 border-amber-300 text-amber-800"
        );
        // Bot√£o manual
        var btn = document.createElement("button");
        btn.className = "mt-2 inline-flex items-center gap-2 rounded-xl px-3 py-2 border border-slate-300 text-sm";
        btn.textContent = "J√° paguei / Verificar pagamento";
        btn.onclick = function(e){ e.preventDefault(); checarAgora(); };
        banner.appendChild(btn);

        // Polling leve a cada 12s
        var timer = setInterval(checarAgora, 12000);

        async function checarAgora(){
          var ref = null;
          try { ref = localStorage.getItem('mp_external_ref'); } catch(e) {}
          if (!ref) return; // ainda n√£o abriu o pagamento nesta sess√£o

          try {
            const r = await fetch('/api/mp-check-status?ref=' + encodeURIComponent(ref));
            const data = await r.json();
            // console.log('[check-status]', data);

            if (data && data.found && data.status === 'approved') {
              clearInterval(timer);
              if (window.fecharPopup) window.fecharPopup();
              setTimeout(abrirWhatsAppComResultado, 300);
            }
          } catch (e) {
            // silencioso
          }
        }
      }
    })();

    // ====== INIT ======
    document.getElementById("year").textContent = new Date().getFullYear();
    renderQuestions();

  })();
  </script>
</body>
</html>
