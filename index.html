<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üß† Descubra sua dieta ideal</title>
  <script src="https://sdk.mercadopago.com/js/v2"></script>
</head>
<body>
  <h1>Teste de Pagamento - Dieta Pronta</h1>
  <p>Responda a √∫nica pergunta e teste o fluxo de pagamento Mercado Pago.</p>
  <form id="quizForm">
    <label>Qual seu principal objetivo?</label><br>
    <input type="radio" name="objetivo" value="A" required> Emagrecer r√°pido<br>
    <input type="radio" name="objetivo" value="B"> Ganhar massa magra<br>
    <input type="radio" name="objetivo" value="C"> Manter peso e sa√∫de<br>
    <button type="submit">Ver resultado</button>
  </form>

  <div id="resultado" style="display:none;">
    <h2>Resultado</h2>
    <p id="descricao"></p>
    <button id="btnPagar">Pagar R$ 9,90</button>
  </div>

  <script>
    const MP_PUBLIC_KEY = 'APP_USR-87cc4830-2ac4-410d-82b8-f295612a75b0';
    const WHATS_NUMBER = '55619998514680';

    document.getElementById('quizForm').addEventListener('submit', function(e){
      e.preventDefault();
      document.getElementById('descricao').innerText = 'Seu plano de dieta est√° pronto!';
      document.getElementById('resultado').style.display = 'block';
    });

    document.getElementById('btnPagar').addEventListener('click', async function(){
      const mp = new MercadoPago(MP_PUBLIC_KEY, { locale: 'pt-BR' });
      const resp = await fetch('https://dietapronta.online/api/mp-preference', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ valor: 9.9, titulo: 'Plano de Dieta Completo' })
      });
      const data = await resp.json();
      if(!data.id){
        alert('Erro ao criar prefer√™ncia. Verifique backend.');
        return;
      }
      mp.checkout({ preference: { id: data.id }, render: { container: document.body, label: 'Pagar agora' } });
    });
  </script>
</body>
</html>
